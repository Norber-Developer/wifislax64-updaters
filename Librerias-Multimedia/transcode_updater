#!/bin/sh

# Script by www.seguridadwireless.net

SCRIPT_VERSION=20161002

############################################################
## Funciones comunes. Su nombre empieza por f_ ##
############################################################
f_variables(){
	. /opt/wifislax-updaters/Funciones/funciones_updater
}

############################################################
## Funciones propias del script. Su nombre empieza por F_ ##
############################################################
# Definicion de variables
F_variables() {
	PRGNAM=transcode
	echo -ne "\033]2;${PRGNAM}_updater\007"
	WEB=https://bitbucket.org/france/transcode-tcforge/downloads/
	VERSION=`curl -s $WEB|grep .bz2|head -1|cut -d- -f 3|cut -d t -f1|sed "s/.$//g"`
	EXTENSION=tar.bz2
	SOURCES=$PRGNAM-$VERSION.$EXTENSION
	DOWNLOAD=https://bitbucket.org/france/transcode-tcforge/downloads/$SOURCES
}

# Comprobar dependencias
F_dependencias(){
DEPENDENCIAS="ffmpeg"
f_dependencias
}

# Descomprimimos el fichero descargado y compilamos
F_compilar(){
echo 
echo "$VERDE"Aplicando parches ..."$CIERRE"
sleep 1
echo "
LS0tIGVuY29kZS9lbmNvZGVfbGF2Yy5jCisrKyBlbmNvZGUvZW5jb2RlX2xhdmMuYwpAQCAtOTU1
LDggKzk1NSw2IEBACiAgICAgLyogCiAgICAgICogY29udGV4dCAqdHJhbnNjb2RlKiAobm90IGxp
YmF2Y29kZWMpIGRlZmF1bHRzCiAgICAgICovCi0gICAgcGQtPmZmX3Zjb250ZXh0Lm1iX3FtaW4g
ICAgICAgICAgICAgICAgID0gMjsKLSAgICBwZC0+ZmZfdmNvbnRleHQubWJfcW1heCAgICAgICAg
ICAgICAgICAgPSAzMTsKICAgICBwZC0+ZmZfdmNvbnRleHQubWF4X3FkaWZmICAgICAgICAgICAg
ICAgPSAzOwogICAgIHBkLT5mZl92Y29udGV4dC5tYXhfYl9mcmFtZXMgICAgICAgICAgICA9IDA7
CiAgICAgcGQtPmZmX3Zjb250ZXh0Lm1lX3JhbmdlICAgICAgICAgICAgICAgID0gMDsKQEAgLTEx
MTYsOCArMTExNCw2IEBACiAgICAgICAgIC8vICBoYW5kbGVkIGJ5IHRyYW5zY29kZSBjb3JlCiAg
ICAgICAgIC8vICB7ICJ2cW1heCIsIFBDVFgocW1heCksIFRDQ09ORl9UWVBFX0lOVCwgVENDT05G
X0ZMQUdfUkFOR0UsIDEsIDYwIH0sCiAgICAgICAgIC8vICBoYW5kbGVkIGJ5IHRyYW5zY29kZSBj
b3JlCi0gICAgICAgIHsgIm1icW1pbiIsIFBDVFgobWJfcW1pbiksIFRDQ09ORl9UWVBFX0lOVCwg
VENDT05GX0ZMQUdfUkFOR0UsIDEsIDYwIH0sCi0gICAgICAgIHsgIm1icW1heCIsIFBDVFgobWJf
cW1heCksIFRDQ09ORl9UWVBFX0lOVCwgVENDT05GX0ZMQUdfUkFOR0UsIDEsIDYwIH0sCiAgICAg
ICAgIHsgImxtaW4iLCBQQVVYKGxtaW4pLCBUQ0NPTkZfVFlQRV9GTE9BVCwgVENDT05GX0ZMQUdf
UkFOR0UsIDAuMDEsIDI1NS4wIH0sCiAgICAgICAgIHsgImxtYXgiLCBQQVVYKGxtYXgpLCBUQ0NP
TkZfVFlQRV9GTE9BVCwgVENDT05GX0ZMQUdfUkFOR0UsIDAuMDEsIDI1NS4wIH0sCiAgICAgICAg
IHsgInZxZGlmZiIsIFBDVFgobWF4X3FkaWZmKSwgVENDT05GX1RZUEVfSU5ULCBUQ0NPTkZfRkxB
R19SQU5HRSwgMSwgMzEgfSwKLS0tIGV4cG9ydC9mZm1wZWdfY2ZnLmMKKysrIGV4cG9ydC9mZm1w
ZWdfY2ZnLmMKQEAgLTM0LDggKzM0LDYgQEAKIC8vaW50IGxhdmNfcGFyYW1fdnFzY2FsZSA9IDA7
CiAvL2ludCBsYXZjX3BhcmFtX3ZxbWluID0gMjsKIC8vaW50IGxhdmNfcGFyYW1fdnFtYXggPSAz
MTsKLWludCBsYXZjX3BhcmFtX21iX3FtaW4gPSAyOwotaW50IGxhdmNfcGFyYW1fbWJfcW1heCA9
IDMxOwogaW50IGxhdmNfcGFyYW1fbG1pbiA9IDI7CiBpbnQgbGF2Y19wYXJhbV9sbWF4ID0gMzE7
CiBpbnQgbGF2Y19wYXJhbV92cWRpZmYgPSAzOwpAQCAtMTQzLDggKzE0MSw2IEBACiAvLyAgICB7
InZxc2NhbGUiLCAmbGF2Y19wYXJhbV92cXNjYWxlLCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09ORl9G
TEFHX1JBTkdFLCAxLCAzMX0sCiAvLyAgICB7InZxbWluIiwgJmxhdmNfcGFyYW1fdnFtaW4sIFRD
Q09ORl9UWVBFX0lOVCwgVENDT05GX0ZMQUdfUkFOR0UsIDEsIDMxfSwKIC8vICAgIHsidnFtYXgi
LCAmbGF2Y19wYXJhbV92cW1heCwgVENDT05GX1RZUEVfSU5ULCBUQ0NPTkZfRkxBR19SQU5HRSwg
MSwgMzF9LAotICAgIHsibWJxbWluIiwgJmxhdmNfcGFyYW1fbWJfcW1pbiwgVENDT05GX1RZUEVf
SU5ULCBUQ0NPTkZfRkxBR19SQU5HRSwgMSwgMzF9LAotICAgIHsibWJxbWF4IiwgJmxhdmNfcGFy
YW1fbWJfcW1heCwgVENDT05GX1RZUEVfSU5ULCBUQ0NPTkZfRkxBR19SQU5HRSwgMSwgMzF9LAog
ICAgIHsibG1pbiIsICZsYXZjX3BhcmFtX2xtaW4sIFRDQ09ORl9UWVBFX0ZMT0FULCBUQ0NPTkZf
RkxBR19SQU5HRSwgMC4wMSwgMjU1LjB9LAogICAgIHsibG1heCIsICZsYXZjX3BhcmFtX2xtYXgs
IFRDQ09ORl9UWVBFX0ZMT0FULCBUQ0NPTkZfRkxBR19SQU5HRSwgMC4wMSwgMjU1LjB9LAogICAg
IHsidnFkaWZmIiwgJmxhdmNfcGFyYW1fdnFkaWZmLCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09ORl9G
TEFHX1JBTkdFLCAxLCAzMX0sCi0tLSBleHBvcnQvZmZtcGVnX2NmZy5oCisrKyBleHBvcnQvZmZt
cGVnX2NmZy5oCkBAIC0xMyw4ICsxMyw2IEBACiAvL2V4dGVybiBpbnQgbGF2Y19wYXJhbV92cXNj
YWxlOwogLy9leHRlcm4gaW50IGxhdmNfcGFyYW1fdnFtaW47CiAvL2V4dGVybiBpbnQgbGF2Y19w
YXJhbV92cW1heDsKLWV4dGVybiBpbnQgbGF2Y19wYXJhbV9tYl9xbWluOwotZXh0ZXJuIGludCBs
YXZjX3BhcmFtX21iX3FtYXg7CiBleHRlcm4gaW50IGxhdmNfcGFyYW1fbG1pbjsKIGV4dGVybiBp
bnQgbGF2Y19wYXJhbV9sbWF4OwogZXh0ZXJuIGludCBsYXZjX3BhcmFtX3ZxZGlmZjsK
" | base64 -d > $TMP/transcode-1.1.7-ffmpeg.patch
patch -p0 -i $TMP/transcode-1.1.7-ffmpeg.patch || exit 1

echo "
aHR0cDovL2J1Z3MuZ2VudG9vLm9yZy80MDEyODcKCi0tLSBmaWx0ZXIvZmlsdGVyX3BwLmMKKysr
IGZpbHRlci9maWx0ZXJfcHAuYwpAQCAtMzgsOCArMzgsOCBAQAogCiAvKiBGSVhNRTogdGhlc2Ug
dXNlIHRoZSBmaWx0ZXIgSUQgYXMgYW4gaW5kZXgtLXRoZSBJRCBjYW4gZ3JvdwogICogYXJiaXRy
YXJpbHkgbGFyZ2UsIHNvIHRoaXMgbmVlZHMgdG8gYmUgZml4ZWQgKi8KLXN0YXRpYyBwcF9tb2Rl
X3QgKm1vZGVbMTAwXTsKLXN0YXRpYyBwcF9jb250ZXh0X3QgKmNvbnRleHRbMTAwXTsKK3N0YXRp
YyBwcF9tb2RlICptb2RlWzEwMF07CitzdGF0aWMgcHBfY29udGV4dCAqY29udGV4dFsxMDBdOwog
c3RhdGljIGludCB3aWR0aFsxMDBdLCBoZWlnaHRbMTAwXTsKIHN0YXRpYyBpbnQgcHJlWzEwMF07
CiAK
" | base64 -d > $TMP/transcode-1.1.7-ffmpeg-0.10.patch
patch -p0 -i $TMP/transcode-1.1.7-ffmpeg-0.10.patch || exit 1

echo "
Rml4IGJ1aWxkIHdpdGggZmZtcGVnIDAuMTEuCmh0dHBzOi8vYnVncy5nZW50b28ub3JnL3Nob3df
YnVnLmNnaT9pZD00MTk1NTEKQXV0aG9yOiBCcmVubmFuIFNoYWNrbGV0dAoKZGlmZiAtdXJOIHRy
YW5zY29kZS0xLjEuNy1vcmlnL2VuY29kZS9lbmNvZGVfbGF2Yy5jIHRyYW5zY29kZS0xLjEuNy9l
bmNvZGUvZW5jb2RlX2xhdmMuYwotLS0gdHJhbnNjb2RlLTEuMS43LW9yaWcvZW5jb2RlL2VuY29k
ZV9sYXZjLmMJMjAxMS0xMS0xOSAwODo1MDoyNy4wMDAwMDAwMDAgLTA4MDAKKysrIHRyYW5zY29k
ZS0xLjEuNy9lbmNvZGUvZW5jb2RlX2xhdmMuYwkyMDEyLTA3LTAzIDEwOjQ3OjAzLjUyODAwOTE0
OSAtMDcwMApAQCAtMTE0LDYgKzExNCw3IEBACiAKICAgICBBVkZyYW1lIGZmX3ZlbmNfZnJhbWU7
CiAgICAgQVZDb2RlY0NvbnRleHQgZmZfdmNvbnRleHQ7CisgICAgQVZEaWN0aW9uYXJ5ICoqIGZm
X29wdHM7CiAKICAgICBBVkNvZGVjICpmZl92Y29kZWM7CiAKQEAgLTEwMzYsMTQgKzEwMzcsMTAg
QEAKICAgICBTRVRfRkxBRyhwZCwgbXYwKTsKICAgICBTRVRfRkxBRyhwZCwgY2JwKTsKICAgICBT
RVRfRkxBRyhwZCwgcXBlbCk7Ci0gICAgU0VUX0ZMQUcocGQsIGFsdCk7Ci0gICAgU0VUX0ZMQUco
cGQsIHZkcGFydCk7CiAgICAgU0VUX0ZMQUcocGQsIG5hcSk7CiAgICAgU0VUX0ZMQUcocGQsIGls
bWUpOwogICAgIFNFVF9GTEFHKHBkLCBpbGRjdCk7CiAgICAgU0VUX0ZMQUcocGQsIGFpYyk7Ci0g
ICAgU0VUX0ZMQUcocGQsIGFpdik7Ci0gICAgU0VUX0ZMQUcocGQsIHVtdik7CiAgICAgU0VUX0ZM
QUcocGQsIHBzbnIpOwogICAgIFNFVF9GTEFHKHBkLCB0cmVsbCk7CiAgICAgU0VUX0ZMQUcocGQs
IGdyYXkpOwpAQCAtMTA2NCw2ICsxMDYxLDE4IEBACiAgICAgICAgIHBkLT5mZl92Y29udGV4dC5m
bGFncyB8PSBDT0RFQ19GTEFHX0lOVEVSTEFDRURfRENUOwogICAgICAgICBwZC0+ZmZfdmNvbnRl
eHQuZmxhZ3MgfD0gQ09ERUNfRkxBR19JTlRFUkxBQ0VEX01FOwogICAgIH0KKyAgICBpZiAocGQt
PmNvbmZkYXRhLmZsYWdzLmFsdCkgeworICAgICAgICBhdl9kaWN0X3NldChwZC0+ZmZfb3B0cywg
ImFsdGVybmF0ZV9zY2FuIiwgIjEiLCAwKTsKKyAgICB9CisgICAgaWYgKHBkLT5jb25mZGF0YS5m
bGFncy52ZHBhcnQpIHsKKyAgICAgICAgYXZfZGljdF9zZXQocGQtPmZmX29wdHMsICJkYXRhX3Bh
cnRpdGlvbmluZyIsICIxIiwgMCk7CisgICAgfQorICAgIGlmIChwZC0+Y29uZmRhdGEuZmxhZ3Mu
dW12KSB7CisgICAgICAgIGF2X2RpY3Rfc2V0KHBkLT5mZl9vcHRzLCAidW12IiwgIjEiLCAwKTsK
KyAgICB9CisgICAgaWYgKHBkLT5jb25mZGF0YS5mbGFncy5haXYpIHsKKyAgICAgICAgYXZfZGlj
dF9zZXQocGQtPmZmX29wdHMsICJhaXYiLCAiMSIsIDApOworICAgIH0KIH0KIAogI3VuZGVmIFNF
VF9GTEFHCkBAIC0xMTg0LDE4ICsxMTkzLDE4IEBACiAgICAgICAgIHsgIm12MCIsIFBBVVgoZmxh
Z3MubXYwKSwgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgQ09ERUNfRkxBR19NVjAgfSwKICAgICAg
ICAgeyAiY2JwIiwgUEFVWChmbGFncy5jYnApLCBUQ0NPTkZfVFlQRV9GTEFHLCAwLCAwLCBDT0RF
Q19GTEFHX0NCUF9SRCB9LAogICAgICAgICB7ICJxcGVsIiwgUEFVWChmbGFncy5xcGVsKSwgVEND
T05GX1RZUEVfRkxBRywgMCwgMCwgQ09ERUNfRkxBR19RUEVMIH0sCi0gICAgICAgIHsgImFsdCIs
IFBBVVgoZmxhZ3MuYWx0KSwgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgQ09ERUNfRkxBR19BTFRf
U0NBTiB9LAorICAgICAgICB7ICJhbHQiLCBQQVVYKGZsYWdzLmFsdCksIFRDQ09ORl9UWVBFX0ZM
QUcsIDAsIDAsIDEgfSwKICAgICAgICAgeyAiaWxtZSIsIFBBVVgoZmxhZ3MuaWxtZSksIFRDQ09O
Rl9UWVBFX0ZMQUcsIDAsIDAsIENPREVDX0ZMQUdfSU5URVJMQUNFRF9NRSB9LAogICAgICAgICB7
ICJpbGRjdCIsIFBBVVgoZmxhZ3MuaWxkY3QpLCBUQ0NPTkZfVFlQRV9GTEFHLCAwLCAwLCBDT0RF
Q19GTEFHX0lOVEVSTEFDRURfRENUIH0sCiAgICAgICAgIHsgIm5hcSIsIFBBVVgoZmxhZ3MubmFx
KSwgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgQ09ERUNfRkxBR19OT1JNQUxJWkVfQVFQIH0sCi0g
ICAgICAgIHsgInZkcGFydCIsIFBBVVgoZmxhZ3MudmRwYXJ0KSwgVENDT05GX1RZUEVfRkxBRywg
MCwgMCwgQ09ERUNfRkxBR19QQVJUIH0sCisgICAgICAgIHsgInZkcGFydCIsIFBBVVgoZmxhZ3Mu
dmRwYXJ0KSwgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgMSB9LAogI2lmIExJQkFWQ09ERUNfVkVS
U0lPTl9JTlQgPCAoKDUyPDwxNikrKDA8PDgpKzApCiAgICAgICAgIHsgImFpYyIsIFBBVVgoZmxh
Z3MuYWljKSwgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgQ09ERUNfRkxBR19IMjYzUF9BSUMgfSwK
ICNlbHNlICAgICAgICAKICAgICAgICAgeyAiYWljIiwgUEFVWChmbGFncy5haWMpLCBUQ0NPTkZf
VFlQRV9GTEFHLCAwLCAwLCBDT0RFQ19GTEFHX0FDX1BSRUQgfSwKICNlbmRpZgotICAgICAgICB7
ICJhaXYiLCBQQVVYKGZsYWdzLmFpdiksIFRDQ09ORl9UWVBFX0ZMQUcsIDAsIDAsIENPREVDX0ZM
QUdfSDI2M1BfQUlWIH0sCi0gICAgICAgIHsgInVtdiIsIFBBVVgoZmxhZ3MudW12KSwgVENDT05G
X1RZUEVfRkxBRywgMCwgMCwgQ09ERUNfRkxBR19IMjYzUF9VTVYgfSwKKyAgICAgICAgeyAiYWl2
IiwgUEFVWChmbGFncy5haXYpLCBUQ0NPTkZfVFlQRV9GTEFHLCAwLCAwLCAxIH0sCisgICAgICAg
IHsgInVtdiIsIFBBVVgoZmxhZ3MudW12KSwgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgMSB9LAog
ICAgICAgICB7ICJwc25yIiwgUEFVWChmbGFncy5wc25yKSwgVENDT05GX1RZUEVfRkxBRywgMCwg
MCwgQ09ERUNfRkxBR19QU05SIH0sCiAjaWYgTElCQVZDT0RFQ19WRVJTSU9OX0lOVCA8ICgoNTI8
PDE2KSsoMDw8OCkrMCkKICAgICAgICAgeyAidHJlbGwiLCBQQVVYKGZsYWdzLnRyZWxsKSwgVEND
T05GX1RZUEVfRkxBRywgMCwgMCwgQ09ERUNfRkxBR19UUkVMTElTX1FVQU5UIH0sCkBAIC0xMzg3
LDcgKzEzOTYsNyBAQAogICAgICAgICAgICAgICAgICAgICBwZC0+Y29uZmRhdGEudGhyZWFkX2Nv
dW50LAogICAgICAgICAgICAgICAgICAgICAocGQtPmNvbmZkYXRhLnRocmVhZF9jb3VudCA+IDEp
ID8icyIgOiIiKTsKICAgICB9Ci0gICAgYXZjb2RlY190aHJlYWRfaW5pdCgmcGQtPmZmX3Zjb250
ZXh0LCBwZC0+Y29uZmRhdGEudGhyZWFkX2NvdW50KTsKKyAgICBwZC0+ZmZfdmNvbnRleHQudGhy
ZWFkX2NvdW50ID0gcGQtPmNvbmZkYXRhLnRocmVhZF9jb3VudDsKIAogICAgIHBkLT5mZl92Y29k
ZWMgPSBhdmNvZGVjX2ZpbmRfZW5jb2RlcihGRl9WQ09ERUNfSUQocGQpKTsKICAgICBpZiAocGQt
PmZmX3Zjb2RlYyA9PSBOVUxMKSB7CkBAIC0xMzk3LDExICsxNDA2LDExIEBACiAgICAgfQogCiAg
ICAgVENfTE9DS19MSUJBVkNPREVDOwotICAgIHJldCA9IGF2Y29kZWNfb3BlbigmcGQtPmZmX3Zj
b250ZXh0LCBwZC0+ZmZfdmNvZGVjKTsKKyAgICByZXQgPSBhdmNvZGVjX29wZW4yKCZwZC0+ZmZf
dmNvbnRleHQsIHBkLT5mZl92Y29kZWMsIHBkLT5mZl9vcHRzKTsKICAgICBUQ19VTkxPQ0tfTElC
QVZDT0RFQzsKIAogICAgIGlmIChyZXQgPCAwKSB7Ci0gICAgICAgIHRjX2xvZ19lcnJvcihNT0Rf
TkFNRSwgImF2Y29kZWNfb3BlbigpIGZhaWxlZCIpOworICAgICAgICB0Y19sb2dfZXJyb3IoTU9E
X05BTUUsICJhdmNvZGVjX29wZW4yKCkgZmFpbGVkIik7CiAgICAgICAgIGdvdG8gZmFpbGVkOwog
ICAgIH0KICAgICAvKiBmaW5hbGx5LCBwYXNzIHVwIHRoZSBleHRyYWRhdGEsIGlmIGFueSAqLwpk
aWZmIC11ck4gdHJhbnNjb2RlLTEuMS43LW9yaWcvZXhwb3J0L2V4cG9ydF9mZm1wZWcuYyB0cmFu
c2NvZGUtMS4xLjcvZXhwb3J0L2V4cG9ydF9mZm1wZWcuYwotLS0gdHJhbnNjb2RlLTEuMS43LW9y
aWcvZXhwb3J0L2V4cG9ydF9mZm1wZWcuYwkyMDExLTExLTE5IDA4OjUwOjI3LjAwMDAwMDAwMCAt
MDgwMAorKysgdHJhbnNjb2RlLTEuMS43L2V4cG9ydC9leHBvcnRfZmZtcGVnLmMJMjAxMi0wNy0w
MyAxMzoxNToyMy45MTgwMTk0MTUgLTA3MDAKQEAgLTEyMiw2ICsxMjIsNyBAQAogc3RhdGljIEFW
RnJhbWUgICAgICAgICAgICAgKmxhdmNfY29udmVydF9mcmFtZSA9IE5VTEw7CiAKIHN0YXRpYyBB
VkNvZGVjICAgICAgICAgICAgICpsYXZjX3ZlbmNfY29kZWMgPSBOVUxMOworc3RhdGljIEFWRGlj
dGlvbmFyeSAgICAgICAgKipsYXZjX3ZlbmNfb3B0cyA9IE5VTEw7CiBzdGF0aWMgQVZGcmFtZSAg
ICAgICAgICAgICAqbGF2Y192ZW5jX2ZyYW1lID0gTlVMTDsKIHN0YXRpYyBBVkNvZGVjQ29udGV4
dCAgICAgICpsYXZjX3ZlbmNfY29udGV4dDsKIHN0YXRpYyBhdmlfdCAgICAgICAgICAgICAgICph
dmlmaWxlID0gTlVMTDsKQEAgLTE4MCw3ICsxODEsNyBAQAogCiAKIC8qIFNUQVJUOiBDT1BJRUQg
RlJPTSBmZm1wZWctMC41X3AyMjg0NihmZm1wZWcuYywgY21kdXRpbHMuYykgKi8KLSNpbmNsdWRl
IDxsaWJhdmNvZGVjL29wdC5oPgorI2luY2x1ZGUgPGxpYmF2dXRpbC9vcHQuaD4KICNpbmNsdWRl
IDxsaWJhdnV0aWwvYXZzdHJpbmcuaD4KICNpbmNsdWRlIDxsaWJzd3NjYWxlL3N3c2NhbGUuaD4K
IApAQCAtNDcwLDcgKzQ3MSw2IEBACiAgICAgfQogCiAgICAgVENfTE9DS19MSUJBVkNPREVDOwot
ICAgIGF2Y29kZWNfaW5pdCgpOwogICAgIGF2Y29kZWNfcmVnaXN0ZXJfYWxsKCk7CiAgICAgVENf
VU5MT0NLX0xJQkFWQ09ERUM7CiAKQEAgLTYzNCw3ICs2MzQsNyBAQAogICAgICAgICBsYXZjX3Bh
cmFtX3JjX21heF9yYXRlID0gMjUxNjsKICAgICAgICAgbGF2Y19wYXJhbV9yY19idWZmZXJfc2l6
ZSA9IDIyNCAqIDg7CiAgICAgICAgIGxhdmNfcGFyYW1fcmNfYnVmZmVyX2FnZ3Jlc3Npdml0eSA9
IDk5OwotICAgICAgICBsYXZjX3BhcmFtX3NjYW5fb2Zmc2V0ID0gQ09ERUNfRkxBR19TVkNEX1ND
QU5fT0ZGU0VUOworICAgICAgICBsYXZjX3BhcmFtX3NjYW5fb2Zmc2V0ID0gMTsKIAogICAgICAg
ICBicmVhazsKIApAQCAtNjc0LDcgKzY3NCw3IEBACiAKICAgICAgICAgbGF2Y19wYXJhbV9yY19i
dWZmZXJfc2l6ZSA9IDIyNCAqIDg7CiAgICAgICAgIGxhdmNfcGFyYW1fcmNfYnVmZmVyX2FnZ3Jl
c3Npdml0eSA9IDk5OwotICAgICAgICBsYXZjX3BhcmFtX3NjYW5fb2Zmc2V0ID0gQ09ERUNfRkxB
R19TVkNEX1NDQU5fT0ZGU0VUOworICAgICAgICBsYXZjX3BhcmFtX3NjYW5fb2Zmc2V0ID0gMTsK
IAogICAgICAgICBicmVhazsKIApAQCAtODg3LDcgKzg4Nyw3IEBACiAJCSAgICBsYXZjX3ZlbmNf
Y29udGV4dC0+dGhyZWFkX2NvdW50KTsKICAgICB9CiAKLSAgICBhdmNvZGVjX3RocmVhZF9pbml0
KGxhdmNfdmVuY19jb250ZXh0LCBsYXZjX3BhcmFtX3RocmVhZHMpOworICAgIGxhdmNfdmVuY19j
b250ZXh0LT50aHJlYWRfY291bnQgPSBsYXZjX3BhcmFtX3RocmVhZHM7CiAKICAgICBpZiAobGF2
Y19wYXJhbV9pbnRyYV9tYXRyaXgpIHsKICAgICAgICAgY2hhciAqdG1wOwpAQCAtMTA2NSwxNSAr
MTA2NSwxMCBAQAogICAgIGxhdmNfdmVuY19jb250ZXh0LT5mbGFncyB8PSBsYXZjX3BhcmFtX2Ns
b3NlZGdvcDsKICAgICBsYXZjX3ZlbmNfY29udGV4dC0+ZmxhZ3MgfD0gbGF2Y19wYXJhbV90cnVu
YzsKICAgICBsYXZjX3ZlbmNfY29udGV4dC0+ZmxhZ3MgfD0gbGF2Y19wYXJhbV9haWM7Ci0gICAg
bGF2Y192ZW5jX2NvbnRleHQtPmZsYWdzIHw9IGxhdmNfcGFyYW1fdW12OwogICAgIGxhdmNfdmVu
Y19jb250ZXh0LT5mbGFncyB8PSBsYXZjX3BhcmFtX3Y0bXY7Ci0gICAgbGF2Y192ZW5jX2NvbnRl
eHQtPmZsYWdzIHw9IGxhdmNfcGFyYW1fZGF0YV9wYXJ0aXRpb25pbmc7CiAgICAgbGF2Y192ZW5j
X2NvbnRleHQtPmZsYWdzIHw9IGxhdmNfcGFyYW1fY2JwOwogICAgIGxhdmNfdmVuY19jb250ZXh0
LT5mbGFncyB8PSBsYXZjX3BhcmFtX212MDsKICAgICBsYXZjX3ZlbmNfY29udGV4dC0+ZmxhZ3Mg
fD0gbGF2Y19wYXJhbV9xcF9yZDsKLSAgICBsYXZjX3ZlbmNfY29udGV4dC0+ZmxhZ3MgfD0gbGF2
Y19wYXJhbV9zY2FuX29mZnNldDsKLSAgICBsYXZjX3ZlbmNfY29udGV4dC0+ZmxhZ3MgfD0gbGF2
Y19wYXJhbV9zczsKLSAgICBsYXZjX3ZlbmNfY29udGV4dC0+ZmxhZ3MgfD0gbGF2Y19wYXJhbV9h
bHQ7CiAgICAgbGF2Y192ZW5jX2NvbnRleHQtPmZsYWdzIHw9IGxhdmNfcGFyYW1faWxtZTsKICNp
ZiBMSUJBVkNPREVDX1ZFUlNJT05fSU5UIDwgKCg1Mjw8MTYpKygwPDw4KSswKSAgIAogICAgIGxh
dmNfdmVuY19jb250ZXh0LT5mbGFncyB8PSBsYXZjX3BhcmFtX3RyZWxsOwpAQCAtMTIwMyw3ICsx
MTk4LDYgQEAKIAogICAgIGxhdmNfdmVuY19jb250ZXh0LT5tZV9tZXRob2QgPSBNRV9aRVJPICsg
bGF2Y19wYXJhbV92bWU7CiAKLQogCS8qIEZJWE1FOiB0cmFuc2NvZGUgaXRzZWxmIGNvbnRhaW5z
ICJicm9rZW4gZmZtcGVnIGRlZmF1bHQgc2V0dGluZ3MiLCB0aHVzIHdlIG5lZWQgdG8gb3ZlcnJp
ZGUgdGhlbSEgKi8KIAlpZiAobGF2Y19wYXJhbV92aWRlb19wcmVzZXQpIHsKIAkJYXZjb2RlY19v
cHRzW0FWTUVESUFfVFlQRV9WSURFT10gPSBsYXZjX3ZlbmNfY29udGV4dDsKQEAgLTEyNDEsMjAg
KzEyMzUsMzkgQEAKIAkJfQogCX0KIAorICAgIGlmIChsYXZjX3BhcmFtX3NjYW5fb2Zmc2V0KSB7
CisgICAgICBhdl9kaWN0X3NldChsYXZjX3ZlbmNfb3B0cywgInNjYW5fb2Zmc2V0IiwgIjEiLCAw
KTsKKyAgICB9CisKKyAgICBpZiAobGF2Y19wYXJhbV9zcykgeworICAgICAgYXZfZGljdF9zZXQo
bGF2Y192ZW5jX29wdHMsICJzdHJ1Y3R1cmVkX3NsaWNlcyIsICIxIiwgMCk7CisgICAgfQorCisg
ICAgaWYgKGxhdmNfcGFyYW1fYWx0KSB7CisgICAgICBhdl9kaWN0X3NldChsYXZjX3ZlbmNfb3B0
cywgImFsdGVybmF0ZV9zY2FuIiwgIjEiLCAwKTsKKyAgICB9CisKKyAgICBpZiAobGF2Y19wYXJh
bV91bXYpIHsKKyAgICAgIGF2X2RpY3Rfc2V0KGxhdmNfdmVuY19vcHRzLCAidW12IiwgIjEiLCAw
KTsKKyAgICB9CisKKyAgICBpZiAobGF2Y19wYXJhbV9kYXRhX3BhcnRpdGlvbmluZykgeworICAg
ICAgYXZfZGljdF9zZXQobGF2Y192ZW5jX29wdHMsICJ2ZHBhcnQiLCAiMSIsIDApOworICAgIH0K
IAogICAgIC8vLS0gb3BlbiBjb2RlYyAtLQogICAgIC8vLS0tLS0tLS0tLS0tLS0tLQogICAgIFRD
X0xPQ0tfTElCQVZDT0RFQzsKLSAgICByZXQgPSBhdmNvZGVjX29wZW4obGF2Y192ZW5jX2NvbnRl
eHQsIGxhdmNfdmVuY19jb2RlYyk7CisgICAgcmV0ID0gYXZjb2RlY19vcGVuMihsYXZjX3ZlbmNf
Y29udGV4dCwgbGF2Y192ZW5jX2NvZGVjLCBsYXZjX3ZlbmNfb3B0cyk7CiAgICAgVENfVU5MT0NL
X0xJQkFWQ09ERUM7CiAgICAgaWYgKHJldCA8IDApIHsKICAgICAgIHRjX2xvZ193YXJuKE1PRF9O
QU1FLCAiY291bGQgbm90IG9wZW4gRkZNUEVHIGNvZGVjIik7CiAgICAgICByZXR1cm4gVENfRVhQ
T1JUX0VSUk9SOwogICAgIH0KIAotICAgIGlmIChsYXZjX3ZlbmNfY29udGV4dC0+Y29kZWMtPmVu
Y29kZSA9PSBOVUxMKSB7CisgICAgaWYgKGF2X2NvZGVjX2lzX2VuY29kZXIobGF2Y192ZW5jX2Nv
bnRleHQtPmNvZGVjKSA9PSAwKSB7CiAgICAgICB0Y19sb2dfd2FybihNT0RfTkFNRSwgImNvdWxk
IG5vdCBvcGVuIEZGTVBFRyBjb2RlYyAiCi0gICAgICAgICAgICAgICIobGF2Y192ZW5jX2NvbnRl
eHQtPmNvZGVjLT5lbmNvZGUgPT0gTlVMTCkiKTsKKyAgICAgICAgICAgICAgIihhdl9jb2RlY19p
c19lbmNvZGVyKGxhdmNfdmVuY19jb250ZXh0LT5jb2RlYykgPT0gMCkiKTsKICAgICAgIHJldHVy
biBUQ19FWFBPUlRfRVJST1I7CiAgICAgfQogCmRpZmYgLXVyTiB0cmFuc2NvZGUtMS4xLjctb3Jp
Zy9leHBvcnQvZmZtcGVnX2NmZy5jIHRyYW5zY29kZS0xLjEuNy9leHBvcnQvZmZtcGVnX2NmZy5j
Ci0tLSB0cmFuc2NvZGUtMS4xLjctb3JpZy9leHBvcnQvZmZtcGVnX2NmZy5jCTIwMTEtMTEtMTkg
MDg6NTA6MjcuMDAwMDAwMDAwIC0wODAwCisrKyB0cmFuc2NvZGUtMS4xLjcvZXhwb3J0L2ZmbXBl
Z19jZmcuYwkyMDEyLTA3LTAzIDEwOjA5OjI1LjAxMTAwMzI1NCAtMDcwMApAQCAtMTYwLDkgKzE2
MCw5IEBACiAgICAgeyJ2Y2VsaW0iLCAmbGF2Y19wYXJhbV9jaHJvbWFfZWxpbV90aHJlc2hvbGQs
IFRDQ09ORl9UWVBFX0lOVCwgVENDT05GX0ZMQUdfUkFOR0UsIC05OSwgOTl9LAogICAgIHsidnBz
aXplIiwgJmxhdmNfcGFyYW1fcGFja2V0X3NpemUsIFRDQ09ORl9UWVBFX0lOVCwgVENDT05GX0ZM
QUdfUkFOR0UsIDAsIDEwMDAwMDAwMH0sCiAgICAgeyJ2c3RyaWN0IiwgJmxhdmNfcGFyYW1fc3Ry
aWN0LCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09ORl9GTEFHX1JBTkdFLCAtOTksIDk5fSwKLSAgICB7
InZkcGFydCIsICZsYXZjX3BhcmFtX2RhdGFfcGFydGl0aW9uaW5nLCBUQ0NPTkZfVFlQRV9GTEFH
LCAwLCAwLCBDT0RFQ19GTEFHX1BBUlR9LAorICAgIHsidmRwYXJ0IiwgJmxhdmNfcGFyYW1fZGF0
YV9wYXJ0aXRpb25pbmcsIFRDQ09ORl9UWVBFX0ZMQUcsIDAsIDAsIDF9LAogLy8gICAgeyJrZXlp
bnQiLCAmbGF2Y19wYXJhbV9rZXlpbnQsIFRDQ09ORl9UWVBFX0lOVCwgMCwgMCwgMH0sCi0gICAg
eyJncmF5IiwgJmxhdmNfcGFyYW1fZ3JheSwgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgQ09ERUNf
RkxBR19QQVJUfSwKKyAgICB7ImdyYXkiLCAmbGF2Y19wYXJhbV9ncmF5LCBUQ0NPTkZfVFlQRV9G
TEFHLCAwLCAwLCBDT0RFQ19GTEFHX0dSQVl9LAogICAgIHsibXBlZ19xdWFudCIsICZsYXZjX3Bh
cmFtX21wZWdfcXVhbnQsIFRDQ09ORl9UWVBFX0ZMQUcsIDAsIDAsIDF9LAogICAgIHsidmlfcWZh
Y3RvciIsICZsYXZjX3BhcmFtX3ZpX3FmYWN0b3IsIFRDQ09ORl9UWVBFX0ZMT0FULCBUQ0NPTkZf
RkxBR19SQU5HRSwgLTMxLjAsIDMxLjB9LAogICAgIHsidmlfcW9mZnNldCIsICZsYXZjX3BhcmFt
X3ZpX3FvZmZzZXQsIFRDQ09ORl9UWVBFX0ZMT0FULCBUQ0NPTkZfRkxBR19SQU5HRSwgMC4wLCAz
MS4wfSwKQEAgLTIxMSw3ICsyMTEsNyBAQAogI2Vsc2UKICAgICB7ImFpYyIsICZsYXZjX3BhcmFt
X2FpYywgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgQ09ERUNfRkxBR19BQ19QUkVEfSwKICNlbmRp
ZiAgICAKLSAgICB7InVtdiIsICZsYXZjX3BhcmFtX3VtdiwgVENDT05GX1RZUEVfRkxBRywgMCwg
MCwgQ09ERUNfRkxBR19IMjYzUF9VTVZ9LAorICAgIHsidW12IiwgJmxhdmNfcGFyYW1fdW12LCBU
Q0NPTkZfVFlQRV9GTEFHLCAwLCAwLCAxfSwKICAgICB7ImliaWFzIiwgJmxhdmNfcGFyYW1faWJp
YXMsIFRDQ09ORl9UWVBFX0lOVCwgVENDT05GX0ZMQUdfUkFOR0UsIC01MTIsIDUxMn0sCiAgICAg
eyJwYmlhcyIsICZsYXZjX3BhcmFtX3BiaWFzLCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09ORl9GTEFH
X1JBTkdFLCAtNTEyLCA1MTJ9LAogICAgIHsiY29kZXIiLCAmbGF2Y19wYXJhbV9jb2RlciwgVEND
T05GX1RZUEVfSU5ULCBUQ0NPTkZfRkxBR19SQU5HRSwgMCwgMTB9LApAQCAtMjIzLDkgKzIyMyw5
IEBACiAgICAgeyJuciIsICZsYXZjX3BhcmFtX25vaXNlX3JlZHVjdGlvbiwgVENDT05GX1RZUEVf
SU5ULCBUQ0NPTkZfRkxBR19SQU5HRSwgMCwgMTAwMDAwMH0sCiAgICAgeyJxcHJkIiwgJmxhdmNf
cGFyYW1fcXBfcmQsIFRDQ09ORl9UWVBFX0ZMQUcsIDAsIDAsIENPREVDX0ZMQUdfUVBfUkR9LAog
ICAgIHsidGhyZWFkcyIsICZsYXZjX3BhcmFtX3RocmVhZHMsIFRDQ09ORl9UWVBFX0lOVCwgVEND
T05GX0ZMQUdfUkFOR0UsIDEsIDE2fSwKLSAgICB7InNzIiwgJmxhdmNfcGFyYW1fc3MsIFRDQ09O
Rl9UWVBFX0ZMQUcsIDAsIDAsIENPREVDX0ZMQUdfSDI2M1BfU0xJQ0VfU1RSVUNUfSwKLSAgICB7
InN2Y2Rfc29mIiwgJmxhdmNfcGFyYW1fc2Nhbl9vZmZzZXQsIFRDQ09ORl9UWVBFX0ZMQUcsIDAs
IDAsIENPREVDX0ZMQUdfU1ZDRF9TQ0FOX09GRlNFVH0sCi0gICAgeyJhbHQiLCAmbGF2Y19wYXJh
bV9hbHQsIFRDQ09ORl9UWVBFX0ZMQUcsIDAsIDAsIENPREVDX0ZMQUdfQUxUX1NDQU59LAorICAg
IHsic3MiLCAmbGF2Y19wYXJhbV9zcywgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgMX0sCisgICAg
eyJzdmNkX3NvZiIsICZsYXZjX3BhcmFtX3NjYW5fb2Zmc2V0LCBUQ0NPTkZfVFlQRV9GTEFHLCAw
LCAwLCAxfSwKKyAgICB7ImFsdCIsICZsYXZjX3BhcmFtX2FsdCwgVENDT05GX1RZUEVfRkxBRywg
MCwgMCwgMX0sCiAgICAgeyJpbG1lIiwgJmxhdmNfcGFyYW1faWxtZSwgVENDT05GX1RZUEVfRkxB
RywgMCwgMCwgQ09ERUNfRkxBR19JTlRFUkxBQ0VEX01FfSwKICAgICB7ImludGVyX3RocmVzaG9s
ZCIsICZsYXZjX3BhcmFtX2ludGVyX3RocmVzaG9sZCwgVENDT05GX1RZUEVfSU5ULCBUQ0NPTkZf
RkxBR19SQU5HRSwgLTEwMDAwMDAsIDEwMDAwMDB9LAogICAgIHsic2NfdGhyZXNob2xkIiwgJmxh
dmNfcGFyYW1fc2NfdGhyZXNob2xkLCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09ORl9GTEFHX1JBTkdF
LCAtMTAwMDAwMCwgMTAwMDAwMH0sCmRpZmYgLXVyTiB0cmFuc2NvZGUtMS4xLjctb3JpZy9pbXBv
cnQvZGVjb2RlX2xhdmMuYyB0cmFuc2NvZGUtMS4xLjcvaW1wb3J0L2RlY29kZV9sYXZjLmMKLS0t
IHRyYW5zY29kZS0xLjEuNy1vcmlnL2ltcG9ydC9kZWNvZGVfbGF2Yy5jCTIwMTEtMTEtMTkgMDg6
NTA6MjcuMDAwMDAwMDAwIC0wODAwCisrKyB0cmFuc2NvZGUtMS4xLjcvaW1wb3J0L2RlY29kZV9s
YXZjLmMJMjAxMi0wNy0wMyAxMDoyMTo0Ni4wODUwMDUxODIgLTA3MDAKQEAgLTE4MSw3ICsxODEs
NyBAQAogI2lmIExJQkFWQ09ERUNfVkVSU0lPTl9JTlQgPCAoKDUyPDwxNikrKDA8PDgpKzApCiAg
IGxhdmNfZGVjX2NvbnRleHQtPmVycm9yX3Jlc2lsaWVuY2UgID0gMjsKICNlbHNlCi0gIGxhdmNf
ZGVjX2NvbnRleHQtPmVycm9yX3JlY29nbml0aW9uID0gMjsKKyAgbGF2Y19kZWNfY29udGV4dC0+
ZXJyX3JlY29nbml0aW9uID0gMjsKICNlbmRpZgogICBsYXZjX2RlY19jb250ZXh0LT5lcnJvcl9j
b25jZWFsbWVudCA9IDM7CiAgIGxhdmNfZGVjX2NvbnRleHQtPndvcmthcm91bmRfYnVncyA9IEZG
X0JVR19BVVRPREVURUNUOwpkaWZmIC11ck4gdHJhbnNjb2RlLTEuMS43LW9yaWcvaW1wb3J0L2lt
cG9ydF9mZm1wZWcuYyB0cmFuc2NvZGUtMS4xLjcvaW1wb3J0L2ltcG9ydF9mZm1wZWcuYwotLS0g
dHJhbnNjb2RlLTEuMS43LW9yaWcvaW1wb3J0L2ltcG9ydF9mZm1wZWcuYwkyMDExLTExLTE5IDA4
OjUwOjI3LjAwMDAwMDAwMCAtMDgwMAorKysgdHJhbnNjb2RlLTEuMS43L2ltcG9ydC9pbXBvcnRf
ZmZtcGVnLmMJMjAxMi0wNy0wMyAxMDoxOTozNi45MzYwMDQ4NDEgLTA3MDAKQEAgLTMxNCw3ICsz
MTQsNyBAQAogI2lmIExJQkFWQ09ERUNfVkVSU0lPTl9JTlQgPCAoKDUyPDwxNikrKDA8PDgpKzAp
CiAgICAgbGF2Y19kZWNfY29udGV4dC0+ZXJyb3JfcmVzaWxpZW5jZSAgPSAyOwogI2Vsc2UKLSAg
ICBsYXZjX2RlY19jb250ZXh0LT5lcnJvcl9yZWNvZ25pdGlvbiA9IDI7CisgICAgbGF2Y19kZWNf
Y29udGV4dC0+ZXJyX3JlY29nbml0aW9uID0gMjsKICNlbmRpZgogICAgIGxhdmNfZGVjX2NvbnRl
eHQtPmVycm9yX2NvbmNlYWxtZW50ID0gMzsKICAgICBsYXZjX2RlY19jb250ZXh0LT53b3JrYXJv
dW5kX2J1Z3MgPSBGRl9CVUdfQVVUT0RFVEVDVDsKZGlmZiAtdXJOIHRyYW5zY29kZS0xLjEuNy1v
cmlnL2ltcG9ydC9wcm9iZV9mZm1wZWcuYyB0cmFuc2NvZGUtMS4xLjcvaW1wb3J0L3Byb2JlX2Zm
bXBlZy5jCi0tLSB0cmFuc2NvZGUtMS4xLjctb3JpZy9pbXBvcnQvcHJvYmVfZmZtcGVnLmMJMjAx
MS0xMS0xOSAwODo1MDoyNy4wMDAwMDAwMDAgLTA4MDAKKysrIHRyYW5zY29kZS0xLjEuNy9pbXBv
cnQvcHJvYmVfZmZtcGVnLmMJMjAxMi0wNy0wMyAxMDo0MTo0Mi43ODIwMDgzMDYgLTA3MDAKQEAg
LTk5LDggKzk5LDggQEAKIAogICAgIFRDX0lOSVRfTElCQVZDT0RFQzsKIAotICAgIHJldCA9IGF2
X29wZW5faW5wdXRfZmlsZSgmbGF2Zl9kbXhfY29udGV4dCwgaXBpcGUtPm5hbWUsCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIE5VTEwsIDAsIE5VTEwpOworICAgIHJldCA9IGF2Zm9ybWF0
X29wZW5faW5wdXQoJmxhdmZfZG14X2NvbnRleHQsIGlwaXBlLT5uYW1lLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBOVUxMLCBOVUxMKTsKICAgICBpZiAocmV0ICE9IDApIHsKICAgICAg
ICAgdGNfbG9nX2Vycm9yKF9fRklMRV9fLCAidW5hYmxlIHRvIG9wZW4gJyVzJyIKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAiIChsaWJhdmZvcm1hdCBmYWlsdXJlKSIsCmRpZmYgLXVy
TiB0cmFuc2NvZGUtMS4xLjctb3JpZy9saWJ0Yy90Y2F2Y29kZWMuaCB0cmFuc2NvZGUtMS4xLjcv
bGlidGMvdGNhdmNvZGVjLmgKLS0tIHRyYW5zY29kZS0xLjEuNy1vcmlnL2xpYnRjL3RjYXZjb2Rl
Yy5oCTIwMTEtMTEtMTkgMDg6NTA6MjcuMDAwMDAwMDAwIC0wODAwCisrKyB0cmFuc2NvZGUtMS4x
LjcvbGlidGMvdGNhdmNvZGVjLmgJMjAxMi0wNy0wMyAxMDozNDo0My42NDgwMDcyMTMgLTA3MDAK
QEAgLTUzLDcgKzUzLDYgQEAKIAogI2RlZmluZSBUQ19JTklUX0xJQkFWQ09ERUMgZG8geyBcCiAg
ICAgVENfTE9DS19MSUJBVkNPREVDOyBcCi0gICAgYXZjb2RlY19pbml0KCk7IFwKICAgICBhdmNv
ZGVjX3JlZ2lzdGVyX2FsbCgpOyBcCiAgICAgVENfVU5MT0NLX0xJQkFWQ09ERUM7IFwKIH0gd2hp
bGUgKDApCg==
" | base64 -d > $TMP/transcode-1.1.7-ffmpeg-0.11.patch
patch -p1 -i $TMP/transcode-1.1.7-ffmpeg-0.11.patch || exit 1

echo "
Rml4IGludmFsaWQgZnJlZSB3aGVuIHByZXNldCBmaWxlIG5vdCBmb3VuZApodHRwczovL2J1Z3Mu
Z2VudG9vLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MzIyOTQ1CkF1dGhvcjogQnJlbm5hbiBTaGFja2xl
dHQKCmRpZmYgLXVyTiB0cmFuc2NvZGUtMS4xLjctb3JpZy9leHBvcnQvZXhwb3J0X2ZmbXBlZy5j
IHRyYW5zY29kZS0xLjEuNy9leHBvcnQvZXhwb3J0X2ZmbXBlZy5jCi0tLSB0cmFuc2NvZGUtMS4x
Ljctb3JpZy9leHBvcnQvZXhwb3J0X2ZmbXBlZy5jCTIwMTEtMTEtMTkgMDg6NTA6MjcuMDAwMDAw
MDAwIC0wODAwCisrKyB0cmFuc2NvZGUtMS4xLjcvZXhwb3J0L2V4cG9ydF9mZm1wZWcuYwkyMDEy
LTA3LTAzIDIwOjA3OjA1LjY2OTA4Mzk0NSAtMDcwMApAQCAtMzIxLDcgKzMyMSw3IEBACiAgICAg
fQogCiAgICAgaWYoIWYpewotICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIkZpbGUgZm9yIHByZXNl
dCAnJXMnIG5vdCBmb3VuZFxuIiwgYXJnKTsKKyAgICAgICAgdGNfbG9nX2Vycm9yKE1PRF9OQU1F
LCAiRmlsZSBmb3IgcHJlc2V0ICclcycgbm90IGZvdW5kIiwgYXJnKTsKICAgICAgICAgYXZfZXhp
dCgxKTsKICAgICB9CiAKQEAgLTEyMDcsNyArMTIwNyw3IEBACiAJLyogRklYTUU6IHRyYW5zY29k
ZSBpdHNlbGYgY29udGFpbnMgImJyb2tlbiBmZm1wZWcgZGVmYXVsdCBzZXR0aW5ncyIsIHRodXMg
d2UgbmVlZCB0byBvdmVycmlkZSB0aGVtISAqLwogCWlmIChsYXZjX3BhcmFtX3ZpZGVvX3ByZXNl
dCkgewogCQlhdmNvZGVjX29wdHNbQVZNRURJQV9UWVBFX1ZJREVPXSA9IGxhdmNfdmVuY19jb250
ZXh0OwotCQl2aWRlb19jb2RlY19uYW1lID0gZmZtcGVnX2NvZGVjX25hbWUoY29kZWMtPm5hbWUp
OworCQl2aWRlb19jb2RlY19uYW1lID0gYXZfc3RyZHVwKGZmbXBlZ19jb2RlY19uYW1lKGNvZGVj
LT5uYW1lKSk7CiAKIAkJY29uc3QgY2hhciAqcHJlc2V0X3N0YXJ0ID0gbGF2Y19wYXJhbV92aWRl
b19wcmVzZXQ7CiAJCXdoaWxlIChwcmVzZXRfc3RhcnQpIHsKQEAgLTEyMjUsNiArMTIyNSw4IEBA
CiAJCQlpZiAob3B0X3ByZXNldCgidnByZSIsIHByZXNldF9uYW1lKSAhPSAwKSB7CiAJCQkJdGNf
bG9nX3dhcm4oTU9EX05BTUUsICJQYXJzaW5nIGZmbXBlZyBwcmVzZXQgJyVzJyBmYWlsZWQiLCBw
cmVzZXRfbmFtZSk7CiAJCQl9CisgICAgICBhdl9mcmVlKHZpZGVvX2NvZGVjX25hbWUpOworICAg
ICAgdmlkZW9fY29kZWNfbmFtZSA9IE5VTEw7CiAJCQlpZiAodmVyYm9zZSkgewogCQkJCWludCBp
OwogCQkJCXRjX2xvZ19pbmZvKE1PRF9OQU1FLCAiQWZ0ZXIgcGFyc2luZyBwcmVzZXQgJyVzJywg
JWkgb3B0aW9ucyBhcmUgb3ZlcnJpZGRlbjoiLCBwcmVzZXRfbmFtZSwgb3B0X25hbWVfY291bnQp
Owo=
" | base64 -d > $TMP/transcode-1.1.7-preset-free.patch
patch -p1 -i $TMP/transcode-1.1.7-preset-free.patch || exit 1

echo "
LS0tIGltcG9ydC9wcm9iZV9mZm1wZWcuYy5vcmlnaW5hbAkyMDEzLTA0LTIyIDIwOjA0OjUxLjA1
ODA4MTM4OCArMDIwMAorKysgaW1wb3J0L3Byb2JlX2ZmbXBlZy5jCTIwMTMtMDQtMjIgMjA6MDU6
MjUuNzQ0MDgxODk3ICswMjAwCkBAIC0xMDksNyArMTA5LDcgQEAgdm9pZCBwcm9iZV9mZm1wZWco
aW5mb190ICppcGlwZSkKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAotICAgIHJldCA9IGF2X2Zp
bmRfc3RyZWFtX2luZm8obGF2Zl9kbXhfY29udGV4dCk7CisgICAgcmV0ID0gYXZmb3JtYXRfZmlu
ZF9zdHJlYW1faW5mbyhsYXZmX2RteF9jb250ZXh0LCBOVUxMKTsKICAgICBpZiAocmV0IDwgMCkg
ewogICAgICAgICB0Y19sb2dfZXJyb3IoX19GSUxFX18sICJ1bmFibGUgdG8gZmV0Y2ggaW5mb3Jt
YXRpb25zIGZyb20gJyVzJyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiIChsaWJh
dmZvcm1hdCBmYWlsdXJlKSIsCi0tLSBpbXBvcnQvZGVjb2RlX2xhdmMuYy5vcmlnaW5hbAkyMDEz
LTA0LTIyIDIwOjA2OjE3LjI2MDA4MjY1MiArMDIwMAorKysgaW1wb3J0L2RlY29kZV9sYXZjLmMJ
MjAxMy0wNC0yMiAyMDowNzo0Ny41NjQwODM5NzUgKzAyMDAKQEAgLTE3MCw3ICsxNzAsNyBAQCB2
b2lkIGRlY29kZV9sYXZjKGRlY29kZV90ICpkZWNvZGUpCiAKICAgLy8gU2V0IHRoZXNlIHRvIHRo
ZSBleHBlY3RlZCB2YWx1ZXMgc28gdGhhdCBmZm1wZWcncyBkZWNvZGVyIGNhbgogICAvLyBwcm9w
ZXJseSBkZXRlY3QgaW50ZXJsYWNlZCBpbnB1dC4KLSAgbGF2Y19kZWNfY29udGV4dCA9IGF2Y29k
ZWNfYWxsb2NfY29udGV4dCgpOworICBsYXZjX2RlY19jb250ZXh0ID0gYXZjb2RlY19hbGxvY19j
b250ZXh0MyhOVUxMKTsKICAgaWYgKGxhdmNfZGVjX2NvbnRleHQgPT0gTlVMTCkgewogICAgICAg
dGNfbG9nX2Vycm9yKF9fRklMRV9fLCAiQ291bGQgbm90IGFsbG9jYXRlIGVub3VnaCBtZW1vcnku
Iik7CiAgICAgICBnb3RvIGRlY29kZXJfZXJyb3I7CkBAIC0xODYsNyArMTg2LDcgQEAgdm9pZCBk
ZWNvZGVfbGF2YyhkZWNvZGVfdCAqZGVjb2RlKQogICBsYXZjX2RlY19jb250ZXh0LT5lcnJvcl9j
b25jZWFsbWVudCA9IDM7CiAgIGxhdmNfZGVjX2NvbnRleHQtPndvcmthcm91bmRfYnVncyA9IEZG
X0JVR19BVVRPREVURUNUOwogCi0gIGlmIChhdmNvZGVjX29wZW4obGF2Y19kZWNfY29udGV4dCwg
bGF2Y19kZWNfY29kZWMpIDwgMCkgeworICBpZiAoYXZjb2RlY19vcGVuMihsYXZjX2RlY19jb250
ZXh0LCBsYXZjX2RlY19jb2RlYywgTlVMTCkgPCAwKSB7CiAgICAgICB0Y19sb2dfZXJyb3IoX19G
SUxFX18sICJDb3VsZCBub3QgaW5pdGlhbGl6ZSB0aGUgJyVzJyBjb2RlYy4iLAogCQkgICBjb2Rl
Yy0+bmFtZSk7CiAgICAgICBnb3RvIGRlY29kZXJfZXJyb3I7Cg==
" | base64 -d > $TMP/transcode-1.1.7-libav-9.patch
patch -p0 -i $TMP/transcode-1.1.7-libav-9.patch || exit 1

echo "
RG8gbm90IGZvcmNlIHVzaW5nIGEgcHJlc2V0LiBEbyBub3QgdHJ5IHRvIG9wZW4gbm9uLWV4aXN0
YW50IHByZXNldCBieSBkZWZhdWx0LgoKSW5kZXg6IHRyYW5zY29kZS0xLjEuNy9leHBvcnQvZXhw
b3J0X2ZmbXBlZy5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT0KLS0tIHRyYW5zY29kZS0xLjEuNy5vcmlnL2V4cG9ydC9l
eHBvcnRfZmZtcGVnLmMKKysrIHRyYW5zY29kZS0xLjEuNy9leHBvcnQvZXhwb3J0X2ZmbXBlZy5j
CkBAIC0xMjA2LDcgKzEyMDYsNyBAQCBNT0RfaW5pdAogICAgIGxhdmNfdmVuY19jb250ZXh0LT5t
ZV9tZXRob2QgPSBNRV9aRVJPICsgbGF2Y19wYXJhbV92bWU7CiAKIAkvKiBGSVhNRTogdHJhbnNj
b2RlIGl0c2VsZiBjb250YWlucyAiYnJva2VuIGZmbXBlZyBkZWZhdWx0IHNldHRpbmdzIiwgdGh1
cyB3ZSBuZWVkIHRvIG92ZXJyaWRlIHRoZW0hICovCi0JaWYgKGxhdmNfcGFyYW1fdmlkZW9fcHJl
c2V0KSB7CisJaWYgKGxhdmNfcGFyYW1fdmlkZW9fcHJlc2V0ICYmIHN0cmNtcChsYXZjX3BhcmFt
X3ZpZGVvX3ByZXNldCwgIm5vbmUiKSkgewogCQlhdmNvZGVjX29wdHNbQVZNRURJQV9UWVBFX1ZJ
REVPXSA9IGxhdmNfdmVuY19jb250ZXh0OwogCQl2aWRlb19jb2RlY19uYW1lID0gYXZfc3RyZHVw
KGZmbXBlZ19jb2RlY19uYW1lKGNvZGVjLT5uYW1lKSk7CiAKSW5kZXg6IHRyYW5zY29kZS0xLjEu
Ny9leHBvcnQvZmZtcGVnX2NmZy5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLS0tIHRyYW5zY29kZS0xLjEuNy5vcmln
L2V4cG9ydC9mZm1wZWdfY2ZnLmMKKysrIHRyYW5zY29kZS0xLjEuNy9leHBvcnQvZmZtcGVnX2Nm
Zy5jCkBAIC0xMjQsNyArMTI0LDcgQEAgaW50IGxhdmNfcGFyYW1fZ21jID0gMDsKIC8vaW50IGxh
dmNfcGFyYW1fYXRhZyA9IDA7CiAvL2ludCBsYXZjX3BhcmFtX2FiaXRyYXRlID0gMjI0OwogCi1j
aGFyICpsYXZjX3BhcmFtX3ZpZGVvX3ByZXNldCA9ICJtZWRpdW0iOworY2hhciAqbGF2Y19wYXJh
bV92aWRlb19wcmVzZXQgPSAibm9uZSI7CiBjaGFyICpsYXZjX3BhcmFtX2ZmbXBlZ19kYXRhZGly
ID0gIi91c3Ivc2hhcmUvZmZtcGVnIjsKIAogVENDb25maWdFbnRyeSBsYXZjb3B0c19jb25mW109
ewo=
" | base64 -d > $TMP/transcode-1.1.7-preset-force.patch
patch -p1 -i $TMP/transcode-1.1.7-preset-force.patch || exit 1

echo "
Rml4IGJ1aWxkIHdpdGggZmZtcGVnLTIuMC4KRml4IHNlZ2ZhdWx0cyBpbnRyb2R1Y2VkIGJ5IHdy
b25nIHVzYWdlIG9mIHRoZSBhdl9kaWN0IEFQSS4KRml4IGZvcmdvdHRlbiBwYXJ0cyBpbiB0aGUg
bGliYXY5IHBhdGNoLgoKSW5kZXg6IHRyYW5zY29kZS0xLjEuNy9lbmNvZGUvZW5jb2RlX2xhdmMu
Ywo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09Ci0tLSB0cmFuc2NvZGUtMS4xLjcub3JpZy9lbmNvZGUvZW5jb2RlX2xhdmMu
YworKysgdHJhbnNjb2RlLTEuMS43L2VuY29kZS9lbmNvZGVfbGF2Yy5jCkBAIC03NCw2ICs3NCw5
IEBAIHN0cnVjdCB0Y2xhdmNjb25maWdkYXRhXyB7CiAgICAgaW50IGxtaW47CiAgICAgaW50IGxt
YXg7CiAgICAgaW50IG1lX21ldGhvZDsKKyAgICBpbnQgbHVtYV9lbGltX3RocmVzaG9sZDsKKyAg
ICBpbnQgY2hyb21hX2VsaW1fdGhyZXNob2xkOworICAgIGludCBxdWFudGl6ZXJfbm9pc2Vfc2hh
cGluZzsKIAogICAgIC8qIHNhbWUgYXMgYWJvdmUgZm9yIGZsYWdzICovCiAgICAgc3RydWN0IHsK
QEAgLTExNCw3ICsxMTcsNyBAQCBzdHJ1Y3QgdGNsYXZjcHJpdmF0ZWRhdGFfIHsKIAogICAgIEFW
RnJhbWUgZmZfdmVuY19mcmFtZTsKICAgICBBVkNvZGVjQ29udGV4dCBmZl92Y29udGV4dDsKLSAg
ICBBVkRpY3Rpb25hcnkgKiogZmZfb3B0czsKKyAgICBBVkRpY3Rpb25hcnkgKiBmZl9vcHRzOwog
CiAgICAgQVZDb2RlYyAqZmZfdmNvZGVjOwogCkBAIC0xNjUsNiArMTY4LDcgQEAgc3RhdGljIGNv
bnN0IFRDQ29kZWNJRCB0Y19sYXZjX2NvZGVjc19vdQogICAgIFRDX0NPREVDX0VSUk9SCiB9Owog
CisjaWYgTElCQVZDT0RFQ19WRVJTSU9OX01BSk9SIDwgNTUKIHN0YXRpYyBjb25zdCBlbnVtIENv
ZGVjSUQgdGNfbGF2Y19pbnRlcm5hbF9jb2RlY3NbXSA9IHsKICAgICBDT0RFQ19JRF9NUEVHMVZJ
REVPLCBDT0RFQ19JRF9NUEVHMlZJREVPLCBDT0RFQ19JRF9NUEVHNCwKICAgICBDT0RFQ19JRF9I
MjYzSSwgQ09ERUNfSURfSDI2M1AsCkBAIC0xNzcsNiArMTgxLDIwIEBAIHN0YXRpYyBjb25zdCBl
bnVtIENvZGVjSUQgdGNfbGF2Y19pbnRlcm4KICAgICBDT0RFQ19JRF9NU01QRUc0VjIsIENPREVD
X0lEX01TTVBFRzRWMywKICAgICBDT0RFQ19JRF9OT05FCiB9OworI2Vsc2UKK3N0YXRpYyBjb25z
dCBlbnVtIEFWQ29kZWNJRCB0Y19sYXZjX2ludGVybmFsX2NvZGVjc1tdID0geworICAgIEFWX0NP
REVDX0lEX01QRUcxVklERU8sIEFWX0NPREVDX0lEX01QRUcyVklERU8sIEFWX0NPREVDX0lEX01Q
RUc0LAorICAgIEFWX0NPREVDX0lEX0gyNjNJLCBBVl9DT0RFQ19JRF9IMjYzUCwKKyAgICBBVl9D
T0RFQ19JRF9IMjY0LAorICAgIEFWX0NPREVDX0lEX1dNVjEsIEFWX0NPREVDX0lEX1dNVjIsCisg
ICAgQVZfQ09ERUNfSURfUlYxMCwKKyAgICBBVl9DT0RFQ19JRF9IVUZGWVVWLCBBVl9DT0RFQ19J
RF9GRlYxLAorICAgIEFWX0NPREVDX0lEX0RWVklERU8sCisgICAgQVZfQ09ERUNfSURfTUpQRUcs
IEFWX0NPREVDX0lEX0xKUEVHLAorICAgIEFWX0NPREVDX0lEX01TTVBFRzRWMiwgQVZfQ09ERUNf
SURfTVNNUEVHNFYzLAorICAgIEFWX0NPREVDX0lEX05PTkUKK307CisjZW5kaWYKIAogc3RhdGlj
IGNvbnN0IFRDRm9ybWF0SUQgdGNfbGF2Y19mb3JtYXRzW10gPSB7IFRDX0ZPUk1BVF9FUlJPUiB9
OwogCkBAIC05MzgsNyArOTU2LDExIEBAIHN0YXRpYyBpbnQgdGNfbGF2Y19zZXR0aW5nc19mcm9t
X3ZvYihUQ0wKIHN0YXRpYyB2b2lkIHRjX2xhdmNfY29uZmlnX2RlZmF1bHRzKFRDTGF2Y1ByaXZh
dGVEYXRhICpwZCkKIHsKICAgICAvKiBmaXJzdCBvZiBhbGwgcmVpbml0aWFsaXplIGxhdmMgZGF0
YSAqLworI2lmIExJQkFWQ09ERUNfVkVSU0lPTl9NQUpPUiA8IDU1CiAgICAgYXZjb2RlY19nZXRf
Y29udGV4dF9kZWZhdWx0cygmcGQtPmZmX3Zjb250ZXh0KTsKKyNlbHNlCisgICAgYXZjb2RlY19n
ZXRfY29udGV4dF9kZWZhdWx0czMoJnBkLT5mZl92Y29udGV4dCwgTlVMTCk7CisjZW5kaWYKIAog
ICAgIHBkLT5jb25mZGF0YS50aHJlYWRfY291bnQgPSAxOwogCkBAIC05NzYsOCArOTk4LDggQEAg
c3RhdGljIHZvaWQgdGNfbGF2Y19jb25maWdfZGVmYXVsdHMoVENMYQogICAgIHBkLT5mZl92Y29u
dGV4dC5tcGVnX3F1YW50ICAgICAgICAgICAgICA9IDA7CiAgICAgcGQtPmZmX3Zjb250ZXh0LnJj
X2luaXRpYWxfY3BseCAgICAgICAgID0gMC4wOwogICAgIHBkLT5mZl92Y29udGV4dC5yY19xc3F1
aXNoICAgICAgICAgICAgICA9IDEuMDsKLSAgICBwZC0+ZmZfdmNvbnRleHQubHVtYV9lbGltX3Ro
cmVzaG9sZCAgICAgPSAwOwotICAgIHBkLT5mZl92Y29udGV4dC5jaHJvbWFfZWxpbV90aHJlc2hv
bGQgICA9IDA7CisgICAgcGQtPmNvbmZkYXRhLmx1bWFfZWxpbV90aHJlc2hvbGQgICAgID0gMDsK
KyAgICBwZC0+Y29uZmRhdGEuY2hyb21hX2VsaW1fdGhyZXNob2xkICAgPSAwOwogICAgIHBkLT5m
Zl92Y29udGV4dC5zdHJpY3Rfc3RkX2NvbXBsaWFuY2UgICA9IDA7CiAgICAgcGQtPmZmX3Zjb250
ZXh0LmRjdF9hbGdvICAgICAgICAgICAgICAgID0gRkZfRENUX0FVVE87CiAgICAgcGQtPmZmX3Zj
b250ZXh0LmlkY3RfYWxnbyAgICAgICAgICAgICAgID0gRkZfSURDVF9BVVRPOwpAQCAtMTAwMSw3
ICsxMDIzLDcgQEAgc3RhdGljIHZvaWQgdGNfbGF2Y19jb25maWdfZGVmYXVsdHMoVENMYQogICAg
IHBkLT5mZl92Y29udGV4dC5pbnRyYV9xdWFudF9iaWFzICAgICAgICA9IEZGX0RFRkFVTFRfUVVB
TlRfQklBUzsKICAgICBwZC0+ZmZfdmNvbnRleHQuaW50ZXJfcXVhbnRfYmlhcyAgICAgICAgPSBG
Rl9ERUZBVUxUX1FVQU5UX0JJQVM7CiAgICAgcGQtPmZmX3Zjb250ZXh0Lm5vaXNlX3JlZHVjdGlv
biAgICAgICAgID0gMDsKLSAgICBwZC0+ZmZfdmNvbnRleHQucXVhbnRpemVyX25vaXNlX3NoYXBp
bmcgPSAwOworICAgIHBkLT5jb25mZGF0YS5xdWFudGl6ZXJfbm9pc2Vfc2hhcGluZyA9IDA7CiAg
ICAgcGQtPmZmX3Zjb250ZXh0LmZsYWdzICAgICAgICAgICAgICAgICAgID0gMDsKIH0KIApAQCAt
MTAzMyw3ICsxMDU1LDYgQEAgc3RhdGljIHZvaWQgdGNfbGF2Y19kaXNwYXRjaF9zZXR0aW5ncyhU
QwogCiAgICAgcGQtPmZmX3Zjb250ZXh0LmZsYWdzID0gMDsKICAgICBTRVRfRkxBRyhwZCwgbXYw
KTsKLSAgICBTRVRfRkxBRyhwZCwgY2JwKTsKICAgICBTRVRfRkxBRyhwZCwgcXBlbCk7CiAgICAg
U0VUX0ZMQUcocGQsIG5hcSk7CiAgICAgU0VUX0ZMQUcocGQsIGlsbWUpOwpAQCAtMTA2MCwxNyAr
MTA4MSwyOSBAQCBzdGF0aWMgdm9pZCB0Y19sYXZjX2Rpc3BhdGNoX3NldHRpbmdzKFRDCiAgICAg
ICAgIHBkLT5mZl92Y29udGV4dC5mbGFncyB8PSBDT0RFQ19GTEFHX0lOVEVSTEFDRURfTUU7CiAg
ICAgfQogICAgIGlmIChwZC0+Y29uZmRhdGEuZmxhZ3MuYWx0KSB7Ci0gICAgICAgIGF2X2RpY3Rf
c2V0KHBkLT5mZl9vcHRzLCAiYWx0ZXJuYXRlX3NjYW4iLCAiMSIsIDApOworICAgICAgICBhdl9k
aWN0X3NldCgmKHBkLT5mZl9vcHRzKSwgImFsdGVybmF0ZV9zY2FuIiwgIjEiLCAwKTsKICAgICB9
CiAgICAgaWYgKHBkLT5jb25mZGF0YS5mbGFncy52ZHBhcnQpIHsKLSAgICAgICAgYXZfZGljdF9z
ZXQocGQtPmZmX29wdHMsICJkYXRhX3BhcnRpdGlvbmluZyIsICIxIiwgMCk7CisgICAgICAgIGF2
X2RpY3Rfc2V0KCYocGQtPmZmX29wdHMpLCAiZGF0YV9wYXJ0aXRpb25pbmciLCAiMSIsIDApOwog
ICAgIH0KICAgICBpZiAocGQtPmNvbmZkYXRhLmZsYWdzLnVtdikgewotICAgICAgICBhdl9kaWN0
X3NldChwZC0+ZmZfb3B0cywgInVtdiIsICIxIiwgMCk7CisgICAgICAgIGF2X2RpY3Rfc2V0KCYo
cGQtPmZmX29wdHMpLCAidW12IiwgIjEiLCAwKTsKICAgICB9CiAgICAgaWYgKHBkLT5jb25mZGF0
YS5mbGFncy5haXYpIHsKLSAgICAgICAgYXZfZGljdF9zZXQocGQtPmZmX29wdHMsICJhaXYiLCAi
MSIsIDApOworICAgICAgICBhdl9kaWN0X3NldCgmKHBkLT5mZl9vcHRzKSwgImFpdiIsICIxIiwg
MCk7CiAgICAgfQorICAgIGlmIChwZC0+Y29uZmRhdGEuZmxhZ3MuY2JwKSB7CisgICAgCWF2X2Rp
Y3Rfc2V0KCYocGQtPmZmX29wdHMpLCAibXB2X2ZsYWdzIiwgIitjYnBfcmQiLCAwKTsKKyAgICB9
CisKKyAgICBjaGFyIGJ1ZlsxMDI0XTsKKyNkZWZpbmUgc2V0X2RpY3Rfb3B0KHZhbCwgb3B0KSBc
CisgICAgc25wcmludGYoYnVmLCBzaXplb2YoYnVmKSwgIiVpIiwgcGQtPmNvbmZkYXRhLnZhbCk7
XAorICAgIGF2X2RpY3Rfc2V0KCYocGQtPmZmX29wdHMpLCBvcHQsIGJ1ZiwgMCkKKworICAgIHNl
dF9kaWN0X29wdChsdW1hX2VsaW1fdGhyZXNob2xkLCAibHVtYV9lbGltX3RocmVzaG9sZCIpOwor
ICAgIHNldF9kaWN0X29wdChjaHJvbWFfZWxpbV90aHJlc2hvbGQsICJjaHJvbWFfZWxpbV90aHJl
c2hvbGQiKTsKKyAgICBzZXRfZGljdF9vcHQocXVhbnRpemVyX25vaXNlX3NoYXBpbmcsICJxdWFu
dGl6ZXJfbm9pc2Vfc2hhcGluZyIpOwogfQogCiAjdW5kZWYgU0VUX0ZMQUcKQEAgLTExNTUsOCAr
MTE4OCw4IEBAIHN0YXRpYyBpbnQgdGNfbGF2Y19yZWFkX2NvbmZpZyhUQ0xhdmNQcmkKICAgICAg
ICAgeyAidnJjX2luaXRfY3BseCIsIFBDVFgocmNfaW5pdGlhbF9jcGx4KSwgVENDT05GX1RZUEVf
RkxPQVQsIFRDQ09ORl9GTEFHX1JBTkdFLCAwLjAsIDk5OTk5OTkuMCB9LAogICAgICAgICAvLyAg
eyAidnJjX2luaXRfb2NjdXBhbmN5IiwgICB9LCAvLyBub3QgeWV0IHN1cHBvcnRlZAogICAgICAg
ICB7ICJ2cXNxdWlzaCIsIFBDVFgocmNfcXNxdWlzaCksIFRDQ09ORl9UWVBFX0ZMT0FULCBUQ0NP
TkZfRkxBR19SQU5HRSwgMC4wLCA5OS4wIH0sCi0gICAgICAgIHsgInZsZWxpbSIsIFBDVFgobHVt
YV9lbGltX3RocmVzaG9sZCksIFRDQ09ORl9UWVBFX0lOVCwgVENDT05GX0ZMQUdfUkFOR0UsIC05
OSwgOTkgfSwKLSAgICAgICAgeyAidmNlbGltIiwgUENUWChjaHJvbWFfZWxpbV90aHJlc2hvbGQp
LCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09ORl9GTEFHX1JBTkdFLCAtOTksIDk5IH0sCisgICAgICAg
IHsgInZsZWxpbSIsIFBBVVgobHVtYV9lbGltX3RocmVzaG9sZCksIFRDQ09ORl9UWVBFX0lOVCwg
VENDT05GX0ZMQUdfUkFOR0UsIC05OSwgOTkgfSwKKyAgICAgICAgeyAidmNlbGltIiwgUEFVWChj
aHJvbWFfZWxpbV90aHJlc2hvbGQpLCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09ORl9GTEFHX1JBTkdF
LCAtOTksIDk5IH0sCiAgICAgICAgIHsgInZzdHJpY3QiLCBQQ1RYKHN0cmljdF9zdGRfY29tcGxp
YW5jZSksIFRDQ09ORl9UWVBFX0lOVCwgVENDT05GX0ZMQUdfUkFOR0UsIC05OSwgOTkgfSwKICAg
ICAgICAgeyAidnBzaXplIiwgUENUWChydHBfcGF5bG9hZF9zaXplKSwgVENDT05GX1RZUEVfSU5U
LCBUQ0NPTkZfRkxBR19SQU5HRSwgMCwgMTAwMDAwMDAwIH0sCiAgICAgICAgIHsgImRjdCIsIFBD
VFgoZGN0X2FsZ28pLCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09ORl9GTEFHX1JBTkdFLCAwLCAxMCB9
LApAQCAtMTE4MiwxMiArMTIxNSwxMiBAQCBzdGF0aWMgaW50IHRjX2xhdmNfcmVhZF9jb25maWco
VENMYXZjUHJpCiAgICAgICAgIHsgImliaWFzIiwgUENUWChpbnRyYV9xdWFudF9iaWFzKSwgVEND
T05GX1RZUEVfSU5ULCBUQ0NPTkZfRkxBR19SQU5HRSwgLTUxMiwgNTEyIH0sCiAgICAgICAgIHsg
InBiaWFzIiwgUENUWChpbnRlcl9xdWFudF9iaWFzKSwgVENDT05GX1RZUEVfSU5ULCBUQ0NPTkZf
RkxBR19SQU5HRSwgLTUxMiwgNTEyIH0sCiAgICAgICAgIHsgIm5yIiwgUENUWChub2lzZV9yZWR1
Y3Rpb24pLCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09ORl9GTEFHX1JBTkdFLCAwLCAxMDAwMDAwfSwK
LSAgICAgICAgeyAicW5zIiwgUENUWChxdWFudGl6ZXJfbm9pc2Vfc2hhcGluZyksIFRDQ09ORl9U
WVBFX0lOVCwgVENDT05GX0ZMQUdfUkFOR0UsIDAsIDMgfSwKKyAgICAgICAgeyAicW5zIiwgUEFV
WChxdWFudGl6ZXJfbm9pc2Vfc2hhcGluZyksIFRDQ09ORl9UWVBFX0lOVCwgVENDT05GX0ZMQUdf
UkFOR0UsIDAsIDMgfSwKICAgICAgICAgeyAiaW50ZXJfbWF0cml4X2ZpbGUiLCBpbnRlcl9tYXRy
aXhfZmlsZSwgVENDT05GX1RZUEVfU1RSSU5HLCAwLCAwLCAwIH0sCiAgICAgICAgIHsgImludHJh
X21hdHJpeF9maWxlIiwgaW50cmFfbWF0cml4X2ZpbGUsIFRDQ09ORl9UWVBFX1NUUklORywgMCwg
MCwgMCB9LAogICAgIAogICAgICAgICB7ICJtdjAiLCBQQVVYKGZsYWdzLm12MCksIFRDQ09ORl9U
WVBFX0ZMQUcsIDAsIDAsIENPREVDX0ZMQUdfTVYwIH0sCi0gICAgICAgIHsgImNicCIsIFBBVVgo
ZmxhZ3MuY2JwKSwgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgQ09ERUNfRkxBR19DQlBfUkQgfSwK
KyAgICAgICAgeyAiY2JwIiwgUEFVWChmbGFncy5jYnApLCBUQ0NPTkZfVFlQRV9GTEFHLCAwLCAw
LCAxIH0sCiAgICAgICAgIHsgInFwZWwiLCBQQVVYKGZsYWdzLnFwZWwpLCBUQ0NPTkZfVFlQRV9G
TEFHLCAwLCAwLCBDT0RFQ19GTEFHX1FQRUwgfSwKICAgICAgICAgeyAiYWx0IiwgUEFVWChmbGFn
cy5hbHQpLCBUQ0NPTkZfVFlQRV9GTEFHLCAwLCAwLCAxIH0sCiAgICAgICAgIHsgImlsbWUiLCBQ
QVVYKGZsYWdzLmlsbWUpLCBUQ0NPTkZfVFlQRV9GTEFHLCAwLCAwLCBDT0RFQ19GTEFHX0lOVEVS
TEFDRURfTUUgfSwKQEAgLTEzNTAsNiArMTM4Myw4IEBAIHN0YXRpYyBpbnQgdGNfbGF2Y19jb25m
aWd1cmUoVENNb2R1bGVJbnMKIAogICAgIHBkID0gc2VsZi0+dXNlcmRhdGE7CiAKKyAgICBwZC0+
ZmZfb3B0cyA9IE5VTEw7CisKICAgICBwZC0+Zmx1c2hfZmxhZyA9IHZvYi0+ZW5jb2Rlcl9mbHVz
aDsKICAgICAKICAgICAvKiBGSVhNRTogbW92ZSBpbnRvIGNvcmU/ICovCkBAIC0xNDAyLDcgKzE0
MzcsNyBAQCBzdGF0aWMgaW50IHRjX2xhdmNfY29uZmlndXJlKFRDTW9kdWxlSW5zCiAgICAgfQog
CiAgICAgVENfTE9DS19MSUJBVkNPREVDOwotICAgIHJldCA9IGF2Y29kZWNfb3BlbjIoJnBkLT5m
Zl92Y29udGV4dCwgcGQtPmZmX3Zjb2RlYywgcGQtPmZmX29wdHMpOworICAgIHJldCA9IGF2Y29k
ZWNfb3BlbjIoJnBkLT5mZl92Y29udGV4dCwgcGQtPmZmX3Zjb2RlYywgJihwZC0+ZmZfb3B0cykp
OwogICAgIFRDX1VOTE9DS19MSUJBVkNPREVDOwogCiAgICAgaWYgKHJldCA8IDApIHsKSW5kZXg6
IHRyYW5zY29kZS0xLjEuNy9leHBvcnQvZXhwb3J0X2ZmbXBlZy5jCj09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLS0tIHRy
YW5zY29kZS0xLjEuNy5vcmlnL2V4cG9ydC9leHBvcnRfZmZtcGVnLmMKKysrIHRyYW5zY29kZS0x
LjEuNy9leHBvcnQvZXhwb3J0X2ZmbXBlZy5jCkBAIC0xMjIsNyArMTIyLDcgQEAgc3RhdGljIHVp
bnQ4X3QgICAgICAgICAgICAgKmltZ19idWZmZXIgPQogc3RhdGljIEFWRnJhbWUgICAgICAgICAg
ICAgKmxhdmNfY29udmVydF9mcmFtZSA9IE5VTEw7CiAKIHN0YXRpYyBBVkNvZGVjICAgICAgICAg
ICAgICpsYXZjX3ZlbmNfY29kZWMgPSBOVUxMOwotc3RhdGljIEFWRGljdGlvbmFyeSAgICAgICAg
KipsYXZjX3ZlbmNfb3B0cyA9IE5VTEw7CitzdGF0aWMgQVZEaWN0aW9uYXJ5ICAgICAgICAqbGF2
Y192ZW5jX29wdHMgPSBOVUxMOwogc3RhdGljIEFWRnJhbWUgICAgICAgICAgICAgKmxhdmNfdmVu
Y19mcmFtZSA9IE5VTEw7CiBzdGF0aWMgQVZDb2RlY0NvbnRleHQgICAgICAqbGF2Y192ZW5jX2Nv
bnRleHQ7CiBzdGF0aWMgYXZpX3QgICAgICAgICAgICAgICAqYXZpZmlsZSA9IE5VTEw7CkBAIC00
ODYsNyArNDg2LDcgQEAgTU9EX2luaXQKIAkJICAgICAgICAgICAgY29kZWMtPm5hbWUsIGNvZGVj
LT5mb3VyQ0MsIGNvZGVjLT5jb21tZW50cyk7CiAgICAgfQogCi0gICAgbGF2Y192ZW5jX2NvbnRl
eHQgPSBhdmNvZGVjX2FsbG9jX2NvbnRleHQoKTsKKyAgICBsYXZjX3ZlbmNfY29udGV4dCA9IGF2
Y29kZWNfYWxsb2NfY29udGV4dDMobGF2Y192ZW5jX2NvZGVjKTsKICAgICBsYXZjX3ZlbmNfZnJh
bWUgICA9IGF2Y29kZWNfYWxsb2NfZnJhbWUoKTsKIAogICAgIGxhdmNfY29udmVydF9mcmFtZT0g
YXZjb2RlY19hbGxvY19mcmFtZSgpOwpAQCAtODM4LDggKzgzOCwxMyBAQCBNT0RfaW5pdAogICAg
IGxhdmNfdmVuY19jb250ZXh0LT5yY19zdHJhdGVneSAgICAgICAgPSBsYXZjX3BhcmFtX3ZyY19z
dHJhdGVneTsKICAgICBsYXZjX3ZlbmNfY29udGV4dC0+Yl9mcmFtZV9zdHJhdGVneSAgID0gbGF2
Y19wYXJhbV92Yl9zdHJhdGVneTsKICAgICBsYXZjX3ZlbmNfY29udGV4dC0+Yl9xdWFudF9vZmZz
ZXQgICAgID0gbGF2Y19wYXJhbV92Yl9xb2Zmc2V0OwotICAgIGxhdmNfdmVuY19jb250ZXh0LT5s
dW1hX2VsaW1fdGhyZXNob2xkPSBsYXZjX3BhcmFtX2x1bWFfZWxpbV90aHJlc2hvbGQ7Ci0gICAg
bGF2Y192ZW5jX2NvbnRleHQtPmNocm9tYV9lbGltX3RocmVzaG9sZD0gbGF2Y19wYXJhbV9jaHJv
bWFfZWxpbV90aHJlc2hvbGQ7CisKKyAgICBjaGFyIGJ1ZlsxMDI0XTsKKyNkZWZpbmUgc2V0X2Rp
Y3Rfb3B0KHZhbCwgb3B0KSBcCisJc25wcmludGYoYnVmLCBzaXplb2YoYnVmKSwgIiVpIiwgdmFs
KTsgXAorCWF2X2RpY3Rfc2V0KCZsYXZjX3ZlbmNfb3B0cywgb3B0LCBidWYsIDApCisgICAgc2V0
X2RpY3Rfb3B0KGxhdmNfcGFyYW1fbHVtYV9lbGltX3RocmVzaG9sZCwgImx1bWFfZWxpbV90aHJl
c2hvbGQiKTsKKyAgICBzZXRfZGljdF9vcHQobGF2Y19wYXJhbV9jaHJvbWFfZWxpbV90aHJlc2hv
bGQsICJjaHJvbWFfZWxpbV90aHJlc2hvbGQiKTsKICAgICBsYXZjX3ZlbmNfY29udGV4dC0+cnRw
X3BheWxvYWRfc2l6ZSAgID0gbGF2Y19wYXJhbV9wYWNrZXRfc2l6ZTsKICNpZiBMSUJBVkNPREVD
X1ZFUlNJT05fSU5UIDwgKCg1Mjw8MTYpKygwPDw4KSswKSAgIAogICAgIGlmIChsYXZjX3BhcmFt
X3BhY2tldF9zaXplKQpAQCAtODcwLDcgKzg3NSw3IEBAIE1PRF9pbml0CiAgICAgbGF2Y192ZW5j
X2NvbnRleHQtPmNvbnRleHRfbW9kZWwgICAgICA9IGxhdmNfcGFyYW1fY29udGV4dDsKICAgICBs
YXZjX3ZlbmNfY29udGV4dC0+c2NlbmVjaGFuZ2VfdGhyZXNob2xkPSBsYXZjX3BhcmFtX3NjX3Ro
cmVzaG9sZDsKICAgICBsYXZjX3ZlbmNfY29udGV4dC0+bm9pc2VfcmVkdWN0aW9uICAgID0gbGF2
Y19wYXJhbV9ub2lzZV9yZWR1Y3Rpb247Ci0gICAgbGF2Y192ZW5jX2NvbnRleHQtPmludGVyX3Ro
cmVzaG9sZCAgICA9IGxhdmNfcGFyYW1faW50ZXJfdGhyZXNob2xkOworICAgIHNldF9kaWN0X29w
dChsYXZjX3BhcmFtX2ludGVyX3RocmVzaG9sZCwgImludGVyX3RocmVzaG9sZCIpOwogICAgIGxh
dmNfdmVuY19jb250ZXh0LT5pbnRyYV9kY19wcmVjaXNpb24gPSBsYXZjX3BhcmFtX2ludHJhX2Rj
X3ByZWNpc2lvbjsKICAgICBsYXZjX3ZlbmNfY29udGV4dC0+c2tpcF90b3AgICAgICAgICAgID0g
bGF2Y19wYXJhbV9za2lwX3RvcDsKICAgICBsYXZjX3ZlbmNfY29udGV4dC0+c2tpcF9ib3R0b20g
ICAgICAgID0gbGF2Y19wYXJhbV9za2lwX2JvdHRvbTsKQEAgLTEwNjYsOSArMTA3MSwxMSBAQCBN
T0RfaW5pdAogICAgIGxhdmNfdmVuY19jb250ZXh0LT5mbGFncyB8PSBsYXZjX3BhcmFtX3RydW5j
OwogICAgIGxhdmNfdmVuY19jb250ZXh0LT5mbGFncyB8PSBsYXZjX3BhcmFtX2FpYzsKICAgICBs
YXZjX3ZlbmNfY29udGV4dC0+ZmxhZ3MgfD0gbGF2Y19wYXJhbV92NG12OwotICAgIGxhdmNfdmVu
Y19jb250ZXh0LT5mbGFncyB8PSBsYXZjX3BhcmFtX2NicDsKKyAgICBpZihsYXZjX3BhcmFtX2Ni
cCkKKyAgICAJYXZfZGljdF9zZXQoJmxhdmNfdmVuY19vcHRzLCAibXB2X2ZsYWdzIiwgIitjYnBf
cmQiLCAwKTsKICAgICBsYXZjX3ZlbmNfY29udGV4dC0+ZmxhZ3MgfD0gbGF2Y19wYXJhbV9tdjA7
Ci0gICAgbGF2Y192ZW5jX2NvbnRleHQtPmZsYWdzIHw9IGxhdmNfcGFyYW1fcXBfcmQ7CisgICAg
aWYobGF2Y19wYXJhbV9xcF9yZCkKKyAgICAJYXZfZGljdF9zZXQoJmxhdmNfdmVuY19vcHRzLCAi
bXB2X2ZsYWdzIiwgIitxcF9yZCIsIDApOwogICAgIGxhdmNfdmVuY19jb250ZXh0LT5mbGFncyB8
PSBsYXZjX3BhcmFtX2lsbWU7CiAjaWYgTElCQVZDT0RFQ19WRVJTSU9OX0lOVCA8ICgoNTI8PDE2
KSsoMDw8OCkrMCkgICAKICAgICBsYXZjX3ZlbmNfY29udGV4dC0+ZmxhZ3MgfD0gbGF2Y19wYXJh
bV90cmVsbDsKQEAgLTEyMzgsMjkgKzEyNDUsMjkgQEAgTU9EX2luaXQKIAl9CiAKICAgICBpZiAo
bGF2Y19wYXJhbV9zY2FuX29mZnNldCkgewotICAgICAgYXZfZGljdF9zZXQobGF2Y192ZW5jX29w
dHMsICJzY2FuX29mZnNldCIsICIxIiwgMCk7CisgICAgICBhdl9kaWN0X3NldCgmbGF2Y192ZW5j
X29wdHMsICJzY2FuX29mZnNldCIsICIxIiwgMCk7CiAgICAgfQogCiAgICAgaWYgKGxhdmNfcGFy
YW1fc3MpIHsKLSAgICAgIGF2X2RpY3Rfc2V0KGxhdmNfdmVuY19vcHRzLCAic3RydWN0dXJlZF9z
bGljZXMiLCAiMSIsIDApOworICAgICAgYXZfZGljdF9zZXQoJmxhdmNfdmVuY19vcHRzLCAic3Ry
dWN0dXJlZF9zbGljZXMiLCAiMSIsIDApOwogICAgIH0KIAogICAgIGlmIChsYXZjX3BhcmFtX2Fs
dCkgewotICAgICAgYXZfZGljdF9zZXQobGF2Y192ZW5jX29wdHMsICJhbHRlcm5hdGVfc2NhbiIs
ICIxIiwgMCk7CisgICAgICBhdl9kaWN0X3NldCgmbGF2Y192ZW5jX29wdHMsICJhbHRlcm5hdGVf
c2NhbiIsICIxIiwgMCk7CiAgICAgfQogCiAgICAgaWYgKGxhdmNfcGFyYW1fdW12KSB7Ci0gICAg
ICBhdl9kaWN0X3NldChsYXZjX3ZlbmNfb3B0cywgInVtdiIsICIxIiwgMCk7CisgICAgICBhdl9k
aWN0X3NldCgmbGF2Y192ZW5jX29wdHMsICJ1bXYiLCAiMSIsIDApOwogICAgIH0KIAogICAgIGlm
IChsYXZjX3BhcmFtX2RhdGFfcGFydGl0aW9uaW5nKSB7Ci0gICAgICBhdl9kaWN0X3NldChsYXZj
X3ZlbmNfb3B0cywgInZkcGFydCIsICIxIiwgMCk7CisgICAgICBhdl9kaWN0X3NldCgmbGF2Y192
ZW5jX29wdHMsICJ2ZHBhcnQiLCAiMSIsIDApOwogICAgIH0KIAogICAgIC8vLS0gb3BlbiBjb2Rl
YyAtLQogICAgIC8vLS0tLS0tLS0tLS0tLS0tLQogICAgIFRDX0xPQ0tfTElCQVZDT0RFQzsKLSAg
ICByZXQgPSBhdmNvZGVjX29wZW4yKGxhdmNfdmVuY19jb250ZXh0LCBsYXZjX3ZlbmNfY29kZWMs
IGxhdmNfdmVuY19vcHRzKTsKKyAgICByZXQgPSBhdmNvZGVjX29wZW4yKGxhdmNfdmVuY19jb250
ZXh0LCBsYXZjX3ZlbmNfY29kZWMsICZsYXZjX3ZlbmNfb3B0cyk7CiAgICAgVENfVU5MT0NLX0xJ
QkFWQ09ERUM7CiAgICAgaWYgKHJldCA8IDApIHsKICAgICAgIHRjX2xvZ193YXJuKE1PRF9OQU1F
LCAiY291bGQgbm90IG9wZW4gRkZNUEVHIGNvZGVjIik7CkluZGV4OiB0cmFuc2NvZGUtMS4xLjcv
ZXhwb3J0L2ZmbXBlZ19jZmcuYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci0tLSB0cmFuc2NvZGUtMS4xLjcub3JpZy9l
eHBvcnQvZmZtcGVnX2NmZy5jCisrKyB0cmFuc2NvZGUtMS4xLjcvZXhwb3J0L2ZmbXBlZ19jZmcu
YwpAQCAtMjE0LDEwICsyMTQsMTAgQEAgVENDb25maWdFbnRyeSBsYXZjb3B0c19jb25mW109ewog
ICAgIHsiY29udGV4dCIsICZsYXZjX3BhcmFtX2NvbnRleHQsIFRDQ09ORl9UWVBFX0lOVCwgVEND
T05GX0ZMQUdfUkFOR0UsIDAsIDEwfSwKICAgICB7ImludHJhX21hdHJpeCIsICZsYXZjX3BhcmFt
X2ludHJhX21hdHJpeCwgVENDT05GX1RZUEVfU1RSSU5HLCAwLCAwLCAwfSwKICAgICB7ImludGVy
X21hdHJpeCIsICZsYXZjX3BhcmFtX2ludGVyX21hdHJpeCwgVENDT05GX1RZUEVfU1RSSU5HLCAw
LCAwLCAwfSwKLSAgICB7ImNicCIsICZsYXZjX3BhcmFtX2NicCwgVENDT05GX1RZUEVfRkxBRywg
MCwgMCwgQ09ERUNfRkxBR19DQlBfUkR9LAorICAgIHsiY2JwIiwgJmxhdmNfcGFyYW1fY2JwLCBU
Q0NPTkZfVFlQRV9GTEFHLCAwLCAwLCAxfSwKICAgICB7Im12MCIsICZsYXZjX3BhcmFtX212MCwg
VENDT05GX1RZUEVfRkxBRywgMCwgMCwgQ09ERUNfRkxBR19NVjB9LAogICAgIHsibnIiLCAmbGF2
Y19wYXJhbV9ub2lzZV9yZWR1Y3Rpb24sIFRDQ09ORl9UWVBFX0lOVCwgVENDT05GX0ZMQUdfUkFO
R0UsIDAsIDEwMDAwMDB9LAotICAgIHsicXByZCIsICZsYXZjX3BhcmFtX3FwX3JkLCBUQ0NPTkZf
VFlQRV9GTEFHLCAwLCAwLCBDT0RFQ19GTEFHX1FQX1JEfSwKKyAgICB7InFwcmQiLCAmbGF2Y19w
YXJhbV9xcF9yZCwgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgMX0sCiAgICAgeyJ0aHJlYWRzIiwg
JmxhdmNfcGFyYW1fdGhyZWFkcywgVENDT05GX1RZUEVfSU5ULCBUQ0NPTkZfRkxBR19SQU5HRSwg
MSwgMTZ9LAogICAgIHsic3MiLCAmbGF2Y19wYXJhbV9zcywgVENDT05GX1RZUEVfRkxBRywgMCwg
MCwgMX0sCiAgICAgeyJzdmNkX3NvZiIsICZsYXZjX3BhcmFtX3NjYW5fb2Zmc2V0LCBUQ0NPTkZf
VFlQRV9GTEFHLCAwLCAwLCAxfSwKSW5kZXg6IHRyYW5zY29kZS0xLjEuNy9leHBvcnQvYXVkX2F1
eC5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT0KLS0tIHRyYW5zY29kZS0xLjEuNy5vcmlnL2V4cG9ydC9hdWRfYXV4LmMK
KysrIHRyYW5zY29kZS0xLjEuNy9leHBvcnQvYXVkX2F1eC5jCkBAIC0zNDYsNyArMzQ2LDcgQEAg
c3RhdGljIGludCB0Y19hdWRpb19pbml0X2ZmbXBlZyh2b2JfdCAqdgogCiAgICAgLy8tLSBzZXQg
cGFyYW1ldGVycyAoYml0cmF0ZSwgY2hhbm5lbHMgYW5kIHNhbXBsZS1yYXRlKSAtLQogICAgIC8v
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0K
LSAgICBhdmNvZGVjX2dldF9jb250ZXh0X2RlZmF1bHRzKCZtcGFfY3R4KTsKKyAgICBhdmNvZGVj
X2dldF9jb250ZXh0X2RlZmF1bHRzMygmbXBhX2N0eCwgbXBhX2NvZGVjKTsKICNpZiBMSUJBVkNP
REVDX1ZFUlNJT05fTUFKT1IgPCA1MwogICAgIG1wYV9jdHguY29kZWNfdHlwZSAgPSBDT0RFQ19U
WVBFX0FVRElPOwogI2Vsc2UKQEAgLTM1OSw3ICszNTksNyBAQCBzdGF0aWMgaW50IHRjX2F1ZGlv
X2luaXRfZmZtcGVnKHZvYl90ICp2CiAgICAgLy8tLSBvcGVuIGNvZGVjIC0tCiAgICAgLy8tLS0t
LS0tLS0tLS0tLS0tCiAgICAgVENfTE9DS19MSUJBVkNPREVDOwotICAgIHJldCA9IGF2Y29kZWNf
b3BlbigmbXBhX2N0eCwgbXBhX2NvZGVjKTsKKyAgICByZXQgPSBhdmNvZGVjX29wZW4yKCZtcGFf
Y3R4LCBtcGFfY29kZWMsIE5VTEwpOwogICAgIFRDX1VOTE9DS19MSUJBVkNPREVDOwogICAgIGlm
IChyZXQgPCAwKSB7CiAgICAgICAgIHRjX3dhcm4oInRjX2F1ZGlvX2luaXRfZmZtcGVnOiBjb3Vs
ZCBub3Qgb3BlbiAlcyBjb2RlYyAhIiwKSW5kZXg6IHRyYW5zY29kZS0xLjEuNy9pbXBvcnQvaW1w
b3J0X2ZmbXBlZy5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT0KLS0tIHRyYW5zY29kZS0xLjEuNy5vcmlnL2ltcG9ydC9p
bXBvcnRfZmZtcGVnLmMKKysrIHRyYW5zY29kZS0xLjEuNy9pbXBvcnQvaW1wb3J0X2ZmbXBlZy5j
CkBAIC0zMDIsNyArMzAyLDcgQEAgZG9fYXZpOgogCiAgICAgLy8gU2V0IHRoZXNlIHRvIHRoZSBl
eHBlY3RlZCB2YWx1ZXMgc28gdGhhdCBmZm1wZWcncyBkZWNvZGVyIGNhbgogICAgIC8vIHByb3Bl
cmx5IGRldGVjdCBpbnRlcmxhY2VkIGlucHV0LgotICAgIGxhdmNfZGVjX2NvbnRleHQgPSBhdmNv
ZGVjX2FsbG9jX2NvbnRleHQoKTsKKyAgICBsYXZjX2RlY19jb250ZXh0ID0gYXZjb2RlY19hbGxv
Y19jb250ZXh0MyhsYXZjX2RlY19jb2RlYyk7CiAgICAgaWYgKGxhdmNfZGVjX2NvbnRleHQgPT0g
TlVMTCkgewogICAgICAgdGNfbG9nX2Vycm9yKE1PRF9OQU1FLCAiQ291bGQgbm90IGFsbG9jYXRl
IGVub3VnaCBtZW1vcnkuIik7CiAgICAgICByZXR1cm4gVENfSU1QT1JUX0VSUk9SOwpAQCAtMzQ0
LDcgKzM0NCw3IEBAIGRvX2F2aToKICAgICB9CiAKICAgICBUQ19MT0NLX0xJQkFWQ09ERUM7Ci0g
ICAgcmV0ID0gYXZjb2RlY19vcGVuKGxhdmNfZGVjX2NvbnRleHQsIGxhdmNfZGVjX2NvZGVjKTsK
KyAgICByZXQgPSBhdmNvZGVjX29wZW4yKGxhdmNfZGVjX2NvbnRleHQsIGxhdmNfZGVjX2NvZGVj
LCBOVUxMKTsKICAgICBUQ19VTkxPQ0tfTElCQVZDT0RFQzsKICAgICBpZiAocmV0IDwgMCkgewog
ICAgICAgdGNfbG9nX3dhcm4oTU9EX05BTUUsICJDb3VsZCBub3QgaW5pdGlhbGl6ZSB0aGUgJyVz
JyBjb2RlYy4iLAo=
" | base64 -d > $TMP/transcode-1.1.7-ffmpeg2.patch
patch -p1 -i $TMP/transcode-1.1.7-ffmpeg2.patch || exit 1

echo "
aHR0cHM6Ly9idWdzLmdlbnRvby5vcmcvc2hvd19idWcuY2dpP2lkPTUyMDE5MAoKSW5kZXg6IHRy
YW5zY29kZS0xLjEuNy9pbXBvcnQvcHJvYmVfZmZtcGVnLmMKPT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQotLS0gdHJhbnNj
b2RlLTEuMS43Lm9yaWcvaW1wb3J0L3Byb2JlX2ZmbXBlZy5jCisrKyB0cmFuc2NvZGUtMS4xLjcv
aW1wb3J0L3Byb2JlX2ZmbXBlZy5jCkBAIC0xMjAsNyArMTIwLDExIEBAIHZvaWQgcHJvYmVfZmZt
cGVnKGluZm9fdCAqaXBpcGUpCiAKICAgICB0cmFuc2xhdGVfaW5mbyhsYXZmX2RteF9jb250ZXh0
LCBpcGlwZS0+cHJvYmVfaW5mbyk7CiAKKyNpZiBMSUJBVkZPUk1BVF9WRVJTSU9OX0lOVCA+IEFW
X1ZFUlNJT05fSU5UKDUzLDI1LDApCisgICAgYXZmb3JtYXRfY2xvc2VfaW5wdXQoJmxhdmZfZG14
X2NvbnRleHQpOworI2Vsc2UKICAgICBhdl9jbG9zZV9pbnB1dF9maWxlKGxhdmZfZG14X2NvbnRl
eHQpOworI2VuZGlmCiAgICAgcmV0dXJuOwogfQogCg==
" | base64 -d > $TMP/transcode-1.1.7-ffmpeg24.patch
patch -p1 -i $TMP/transcode-1.1.7-ffmpeg24.patch || exit 1

FFMPEGSERIES=$(ffmpeg -version|grep version|head -1|cut -d ' ' -f3|cut -d. -f1)
if [ $FFMPEGSERIES = "3" ]; then
echo "
SW5kZXg6IHRyYW5zY29kZS0xLjEuNy9lbmNvZGUvZW5jb2RlX2xhdmMuYwo9PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci0t
LSB0cmFuc2NvZGUtMS4xLjcub3JpZy9lbmNvZGUvZW5jb2RlX2xhdmMuYworKysgdHJhbnNjb2Rl
LTEuMS43L2VuY29kZS9lbmNvZGVfbGF2Yy5jCkBAIC0yMzMsNyArMjMzLDcgQEAgc3RhdGljIHZv
aWQgcHJlX2VuY29kZV92aWRlb195dXY0MjBwKFRDTAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHZmcmFtZV9saXN0X3QgKnZmcmFtZSkKIHsKICAgICBhdnBpY3R1cmVfZmls
bCgoQVZQaWN0dXJlICopJnBkLT5mZl92ZW5jX2ZyYW1lLCB2ZnJhbWUtPnZpZGVvX2J1ZiwKLSAg
ICAgICAgICAgICAgICAgICAgUElYX0ZNVF9ZVVY0MjBQLAorICAgICAgICAgICAgICAgICAgICBB
Vl9QSVhfRk1UX1lVVjQyMFAsCiAgICAgICAgICAgICAgICAgICAgIHBkLT5mZl92Y29udGV4dC53
aWR0aCwgcGQtPmZmX3Zjb250ZXh0LmhlaWdodCk7CiB9CiAKQEAgLTI0Nyw3ICsyNDcsNyBAQCBz
dGF0aWMgdm9pZCBwcmVfZW5jb2RlX3ZpZGVvX3l1djQyMHBfaHVmCiAgICAgICAgICAgICAgICAg
ICAgIElNR19ZVVZfREVGQVVMVCwKICAgICAgICAgICAgICAgICAgICAgcGQtPmZmX3Zjb250ZXh0
LndpZHRoLCBwZC0+ZmZfdmNvbnRleHQuaGVpZ2h0KTsKICAgICBhdnBpY3R1cmVfZmlsbCgoQVZQ
aWN0dXJlICopJnBkLT5mZl92ZW5jX2ZyYW1lLCBwZC0+dmZyYW1lX2J1Zi0+dmlkZW9fYnVmLAot
ICAgICAgICAgICAgICAgICAgIFBJWF9GTVRfWVVWNDIyUCwKKyAgICAgICAgICAgICAgICAgICBB
Vl9QSVhfRk1UX1lVVjQyMlAsCiAgICAgICAgICAgICAgICAgICAgcGQtPmZmX3Zjb250ZXh0Lndp
ZHRoLCBwZC0+ZmZfdmNvbnRleHQuaGVpZ2h0KTsKICAgICBhY19pbWdjb252ZXJ0KHNyYywgSU1H
X1lVVl9ERUZBVUxULAogICAgICAgICAgICAgICAgICAgcGQtPmZmX3ZlbmNfZnJhbWUuZGF0YSwg
SU1HX1lVVjQyMlAsCkBAIC0yNjMsNyArMjYzLDcgQEAgc3RhdGljIHZvaWQgcHJlX2VuY29kZV92
aWRlb195dXY0MjJwKFRDTAogICAgICAgICAgICAgICAgICAgICBJTUdfWVVWNDIyUCwKICAgICAg
ICAgICAgICAgICAgICAgcGQtPmZmX3Zjb250ZXh0LndpZHRoLCBwZC0+ZmZfdmNvbnRleHQuaGVp
Z2h0KTsKICAgICBhdnBpY3R1cmVfZmlsbCgoQVZQaWN0dXJlICopJnBkLT5mZl92ZW5jX2ZyYW1l
LCBwZC0+dmZyYW1lX2J1Zi0+dmlkZW9fYnVmLAotICAgICAgICAgICAgICAgICAgIFBJWF9GTVRf
WVVWNDIwUCwKKyAgICAgICAgICAgICAgICAgICBBVl9QSVhfRk1UX1lVVjQyMFAsCiAgICAgICAg
ICAgICAgICAgICAgcGQtPmZmX3Zjb250ZXh0LndpZHRoLCBwZC0+ZmZfdmNvbnRleHQuaGVpZ2h0
KTsKICAgICBhY19pbWdjb252ZXJ0KHNyYywgSU1HX1lVVjQyMlAsCiAgICAgICAgICAgICAgICAg
ICBwZC0+ZmZfdmVuY19mcmFtZS5kYXRhLCBJTUdfWVVWNDIwUCwKQEAgLTI3NSw3ICsyNzUsNyBA
QCBzdGF0aWMgdm9pZCBwcmVfZW5jb2RlX3ZpZGVvX3l1djQyMnBfaHVmCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZnJhbWVfbGlzdF90ICp2ZnJhbWUpCiB7
CiAgICAgYXZwaWN0dXJlX2ZpbGwoKEFWUGljdHVyZSAqKSZwZC0+ZmZfdmVuY19mcmFtZSwgdmZy
YW1lLT52aWRlb19idWYsCi0gICAgICAgICAgICAgICAgICAgUElYX0ZNVF9ZVVY0MjJQLAorICAg
ICAgICAgICAgICAgICAgIEFWX1BJWF9GTVRfWVVWNDIyUCwKICAgICAgICAgICAgICAgICAgICBw
ZC0+ZmZfdmNvbnRleHQud2lkdGgsIHBkLT5mZl92Y29udGV4dC5oZWlnaHQpOwogCiB9CkBAIC0y
ODUsNyArMjg1LDcgQEAgc3RhdGljIHZvaWQgcHJlX2VuY29kZV92aWRlb19yZ2IyNChUQ0xhdgog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZnJhbWVfbGlzdF90ICp2ZnJhbWUp
CiB7CiAgICAgYXZwaWN0dXJlX2ZpbGwoKEFWUGljdHVyZSAqKSZwZC0+ZmZfdmVuY19mcmFtZSwg
cGQtPnZmcmFtZV9idWYtPnZpZGVvX2J1ZiwKLSAgICAgICAgICAgICAgICAgICBQSVhfRk1UX1lV
VjQyMFAsCisgICAgICAgICAgICAgICAgICAgQVZfUElYX0ZNVF9ZVVY0MjBQLAogICAgICAgICAg
ICAgICAgICAgIHBkLT5mZl92Y29udGV4dC53aWR0aCwgcGQtPmZmX3Zjb250ZXh0LmhlaWdodCk7
CiAgICAgYWNfaW1nY29udmVydCgmdmZyYW1lLT52aWRlb19idWYsIElNR19SR0JfREVGQVVMVCwK
ICAgICAgICAgICAgICAgICAgIHBkLT5mZl92ZW5jX2ZyYW1lLmRhdGEsIElNR19ZVVY0MjBQLApA
QCAtNjEwLDIxICs2MTAsMjEgQEAgc3RhdGljIGludCB0Y19sYXZjX3NldF9waXhfZm10KFRDTGF2
Y1ByaQogICAgICAgY2FzZSBDT0RFQ19ZVVY6CiAgICAgICAgIGlmIChUQ19WQ09ERUNfSUQocGQp
ID09IFRDX0NPREVDX0hVRkZZVVYpIHsKICAgICAgICAgICAgIHBkLT50Y19waXhfZm10ID0gVENf
Q09ERUNfWVVWNDIyUDsKLSAgICAgICAgICAgIHBkLT5mZl92Y29udGV4dC5waXhfZm10ID0gUElY
X0ZNVF9ZVVY0MjJQOworICAgICAgICAgICAgcGQtPmZmX3Zjb250ZXh0LnBpeF9mbXQgPSBBVl9Q
SVhfRk1UX1lVVjQyMlA7CiAgICAgICAgICAgICBwZC0+cHJlX2VuY29kZV92aWRlbyA9IHByZV9l
bmNvZGVfdmlkZW9feXV2NDIwcF9odWZmeXV2OwogICAgICAgICB9IGVsc2UgewogICAgICAgICAg
ICAgcGQtPnRjX3BpeF9mbXQgPSBUQ19DT0RFQ19ZVVY0MjBQOwogICAgICAgICAgICAgcGQtPmZm
X3Zjb250ZXh0LnBpeF9mbXQgPSAoVENfVkNPREVDX0lEKHBkKSA9PSBUQ19DT0RFQ19NSlBFRykg
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IFBJWF9GTVRfWVVWSjQy
MFAKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogUElYX0ZNVF9ZVVY0
MjBQOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBBVl9QSVhfRk1U
X1lVVko0MjBQCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IEFWX1BJ
WF9GTVRfWVVWNDIwUDsKICAgICAgICAgICAgIHBkLT5wcmVfZW5jb2RlX3ZpZGVvID0gcHJlX2Vu
Y29kZV92aWRlb195dXY0MjBwOwogICAgICAgICB9CiAgICAgICAgIGJyZWFrOwogICAgICAgY2Fz
ZSBDT0RFQ19ZVVY0MjI6CiAgICAgICAgIHBkLT50Y19waXhfZm10ID0gVENfQ09ERUNfWVVWNDIy
UDsKICAgICAgICAgcGQtPmZmX3Zjb250ZXh0LnBpeF9mbXQgPSAoVENfVkNPREVDX0lEKHBkKSA9
PSBUQ19DT0RFQ19NSlBFRykgCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8g
UElYX0ZNVF9ZVVZKNDIyUAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IFBJ
WF9GTVRfWVVWNDIyUDsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBBVl9Q
SVhfRk1UX1lVVko0MjJQCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogQVZf
UElYX0ZNVF9ZVVY0MjJQOwogICAgICAgICBpZiAoVENfVkNPREVDX0lEKHBkKSA9PSBUQ19DT0RF
Q19IVUZGWVVWKSB7CiAgICAgICAgICAgICBwZC0+cHJlX2VuY29kZV92aWRlbyA9IHByZV9lbmNv
ZGVfdmlkZW9feXV2NDIycF9odWZmeXV2OwogICAgICAgICB9IGVsc2UgewpAQCAtNjM0LDEwICs2
MzQsMTAgQEAgc3RhdGljIGludCB0Y19sYXZjX3NldF9waXhfZm10KFRDTGF2Y1ByaQogICAgICAg
Y2FzZSBDT0RFQ19SR0I6CiAgICAgICAgIHBkLT50Y19waXhfZm10ID0gVENfQ09ERUNfUkdCOwog
ICAgICAgICBwZC0+ZmZfdmNvbnRleHQucGl4X2ZtdCA9IChUQ19WQ09ERUNfSUQocGQpID09IFRD
X0NPREVDX0hVRkZZVVYpCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
PyBQSVhfRk1UX1lVVjQyMlAKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICA/IEFWX1BJWF9GTVRfWVVWNDIyUAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIDogKFRDX1ZDT0RFQ19JRChwZCkgPT0gVENfQ09ERUNfTUpQRUcpIAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gUElYX0ZNVF9ZVVZKNDIwUAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogUElYX0ZNVF9ZVVY0MjBQ
OworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gQVZfUElYX0ZN
VF9ZVVZKNDIwUAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDog
QVZfUElYX0ZNVF9ZVVY0MjBQOwogICAgICAgICBwZC0+cHJlX2VuY29kZV92aWRlbyA9IHByZV9l
bmNvZGVfdmlkZW9fcmdiMjQ7CiAgICAgICAgIGJyZWFrOwogICAgICAgZGVmYXVsdDoKQEAgLTEz
OTAsNyArMTM5MCw3IEBAIHN0YXRpYyBpbnQgdGNfbGF2Y19jb25maWd1cmUoVENNb2R1bGVJbnMK
ICAgICAvKiBGSVhNRTogbW92ZSBpbnRvIGNvcmU/ICovCiAgICAgVENfSU5JVF9MSUJBVkNPREVD
OwogCi0gICAgYXZjb2RlY19nZXRfZnJhbWVfZGVmYXVsdHMoJnBkLT5mZl92ZW5jX2ZyYW1lKTsK
KyAgICBhdl9mcmFtZV91bnJlZigmcGQtPmZmX3ZlbmNfZnJhbWUpOwogICAgIC8qCiAgICAgICog
YXV4aWxpYXJ5IGNvbmZpZyBkYXRhIG5lZWRzIHRvIGJlIGJsYW5rZWQgdG9vCiAgICAgICogYmVm
b3JlIGFueSBvdGhlciBvcGVyYXRpb24KQEAgLTE1MjMsNiArMTUyMyw4IEBAIHN0YXRpYyBpbnQg
dGNfbGF2Y19lbmNvZGVfdmlkZW8oVENNb2R1bGUKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgdmZyYW1lX2xpc3RfdCAqb3V0ZnJhbWUpCiB7CiAgICAgVENMYXZjUHJpdmF0ZURhdGEg
KnBkID0gTlVMTDsKKyAgICBBVlBhY2tldCBwa3Q7CisgICAgaW50IHJldCwgZ290X3BhY2tldCA9
IDA7CiAKICAgICBUQ19NT0RVTEVfU0VMRl9DSEVDSyhzZWxmLCAiZW5jb2RlX3ZpZGVvIik7CiAK
QEAgLTE1MzcsMTIgKzE1MzksMTUgQEAgc3RhdGljIGludCB0Y19sYXZjX2VuY29kZV92aWRlbyhU
Q01vZHVsZQogCiAgICAgcGQtPnByZV9lbmNvZGVfdmlkZW8ocGQsIGluZnJhbWUpOyAKIAorICAg
IGF2X2luaXRfcGFja2V0KCZwa3QpOworICAgIHBrdC5kYXRhID0gb3V0ZnJhbWUtPnZpZGVvX2J1
ZjsKKyAgICBwa3Quc2l6ZSA9IGluZnJhbWUtPnZpZGVvX3NpemU7CisKICAgICBUQ19MT0NLX0xJ
QkFWQ09ERUM7Ci0gICAgb3V0ZnJhbWUtPnZpZGVvX2xlbiA9IGF2Y29kZWNfZW5jb2RlX3ZpZGVv
KCZwZC0+ZmZfdmNvbnRleHQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIG91dGZyYW1lLT52aWRlb19idWYsCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGluZnJhbWUtPnZpZGVvX3NpemUsCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZwZC0+ZmZfdmVuY19mcmFtZSk7Cisg
ICAgcmV0ID0gYXZjb2RlY19lbmNvZGVfdmlkZW8yKCZwZC0+ZmZfdmNvbnRleHQsICAgJnBrdCwK
KyAgICAJCQkJJnBkLT5mZl92ZW5jX2ZyYW1lLCAmZ290X3BhY2tldCk7CiAgICAgVENfVU5MT0NL
X0xJQkFWQ09ERUM7CisgICAgb3V0ZnJhbWUtPnZpZGVvX2xlbiA9IHJldCA/IHJldCA6IHBrdC5z
aXplOwogCiAgICAgaWYgKG91dGZyYW1lLT52aWRlb19sZW4gPCAwKSB7CiAgICAgICAgIHRjX2xv
Z193YXJuKE1PRF9OQU1FLCAiZW5jb2RlciBlcnJvcjogc2l6ZSAoJWkpIiwKSW5kZXg6IHRyYW5z
Y29kZS0xLjEuNy9leHBvcnQvZXhwb3J0X2ZmbXBlZy5jCj09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLS0tIHRyYW5zY29k
ZS0xLjEuNy5vcmlnL2V4cG9ydC9leHBvcnRfZmZtcGVnLmMKKysrIHRyYW5zY29kZS0xLjEuNy9l
eHBvcnQvZXhwb3J0X2ZmbXBlZy5jCkBAIC0yNTAsOSArMjUwLDkgQEAgaW50IG9wdF9kZWZhdWx0
KGNvbnN0IGNoYXIgKm9wdCwgY29uc3QgYwogICAgIGZvcih0eXBlPTA7IHR5cGU8QVZNRURJQV9U
WVBFX05CICYmIHJldD49IDA7IHR5cGUrKyl7CiAJCS8qIEdMVUU6ICtpZiAqLwogCQlpZiAodHlw
ZSA9PSBBVk1FRElBX1RZUEVfVklERU8pIHsKLSAgICAgICAgY29uc3QgQVZPcHRpb24gKm8yID0g
YXZfZmluZF9vcHQoYXZjb2RlY19vcHRzWzBdLCBvcHQsIE5VTEwsIG9wdF90eXBlc1t0eXBlXSwg
b3B0X3R5cGVzW3R5cGVdKTsKLSAgICAgICAgaWYobzIpCi0gICAgICAgICAgICByZXQgPSBhdl9z
ZXRfc3RyaW5nMyhhdmNvZGVjX29wdHNbdHlwZV0sIG9wdCwgYXJnLCAxLCAmbyk7CisgICAgICAg
IG8gPSBhdl9vcHRfZmluZChhdmNvZGVjX29wdHNbMF0sIG9wdCwgTlVMTCwgb3B0X3R5cGVzW3R5
cGVdLCBvcHRfdHlwZXNbdHlwZV0pOworICAgICAgICBpZihvKQorICAgICAgICAgICAgcmV0ID0g
YXZfb3B0X3NldChhdmNvZGVjX29wdHNbdHlwZV0sIG9wdCwgYXJnLCAwKTsKIAkJLyogR0xVRTog
K2lmICovCiAJCX0KICAgICB9CkBAIC0yNjcsNyArMjY3LDEwIEBAIGludCBvcHRfZGVmYXVsdChj
b25zdCBjaGFyICpvcHQsIGNvbnN0IGMKICAgICAgICAgaWYob3B0WzBdID09ICdhJykKICAgICAg
ICAgICAgIHJldCA9IGF2X3NldF9zdHJpbmczKGF2Y29kZWNfb3B0c1tBVk1FRElBX1RZUEVfQVVE
SU9dLCBvcHQrMSwgYXJnLCAxLCAmbyk7CiAgICAgICAgIGVsc2UgKi8gaWYob3B0WzBdID09ICd2
JykKLSAgICAgICAgICAgIHJldCA9IGF2X3NldF9zdHJpbmczKGF2Y29kZWNfb3B0c1tBVk1FRElB
X1RZUEVfVklERU9dLCBvcHQrMSwgYXJnLCAxLCAmbyk7CisJeworCSAgICBvID0gYXZfb3B0X2Zp
bmQoYXZjb2RlY19vcHRzW0FWTUVESUFfVFlQRV9WSURFT10sIG9wdCsxLCBOVUxMLCAwLCAwKTsK
KyAgICAgICAgICAgIHJldCA9IGF2X29wdF9zZXQoYXZjb2RlY19vcHRzW0FWTUVESUFfVFlQRV9W
SURFT10sIG9wdCsxLCBhcmcsIDApOworCX0KIAkJLyogR0xVRTogZGlzYWJsaW5nCiAgICAgICAg
IGVsc2UgaWYob3B0WzBdID09ICdzJykKICAgICAgICAgICAgIHJldCA9IGF2X3NldF9zdHJpbmcz
KGF2Y29kZWNfb3B0c1tBVk1FRElBX1RZUEVfU1VCVElUTEVdLCBvcHQrMSwgYXJnLCAxLCAmbyk7
CkBAIC00ODcsMTAgKzQ5MCwxMCBAQCBNT0RfaW5pdAogICAgIH0KIAogICAgIGxhdmNfdmVuY19j
b250ZXh0ID0gYXZjb2RlY19hbGxvY19jb250ZXh0MyhsYXZjX3ZlbmNfY29kZWMpOwotICAgIGxh
dmNfdmVuY19mcmFtZSAgID0gYXZjb2RlY19hbGxvY19mcmFtZSgpOworICAgIGxhdmNfdmVuY19m
cmFtZSAgID0gYXZfZnJhbWVfYWxsb2MoKTsKIAotICAgIGxhdmNfY29udmVydF9mcmFtZT0gYXZj
b2RlY19hbGxvY19mcmFtZSgpOwotICAgIHNpemUgPSBhdnBpY3R1cmVfZ2V0X3NpemUoUElYX0ZN
VF9SR0IyNCwgdm9iLT5leF92X3dpZHRoLCB2b2ItPmV4X3ZfaGVpZ2h0KTsKKyAgICBsYXZjX2Nv
bnZlcnRfZnJhbWU9IGF2X2ZyYW1lX2FsbG9jKCk7CisgICAgc2l6ZSA9IGF2cGljdHVyZV9nZXRf
c2l6ZShBVl9QSVhfRk1UX1JHQjI0LCB2b2ItPmV4X3Zfd2lkdGgsIHZvYi0+ZXhfdl9oZWlnaHQp
OwogICAgIGVuY19idWZmZXIgPSB0Y19tYWxsb2Moc2l6ZSk7CiAKICAgICBpZiAobGF2Y192ZW5j
X2NvbnRleHQgPT0gTlVMTCB8fCAhZW5jX2J1ZmZlciB8fCAhbGF2Y19jb252ZXJ0X2ZyYW1lKSB7
CkBAIC0xMTE0LDcgKzExMTcsNyBAQCBNT0RfaW5pdAogICAgIGxhdmNfdmVuY19jb250ZXh0LT5w
cmVkaWN0aW9uX21ldGhvZCA9IGxhdmNfcGFyYW1fcHJlZGljdGlvbl9tZXRob2Q7CiAKICAgICBp
Zihpc19odWZmeXV2KQotICAgICAgICBsYXZjX3ZlbmNfY29udGV4dC0+cGl4X2ZtdCA9IFBJWF9G
TVRfWVVWNDIyUDsKKyAgICAgICAgbGF2Y192ZW5jX2NvbnRleHQtPnBpeF9mbXQgPSBBVl9QSVhf
Rk1UX1lVVjQyMlA7CiAgICAgZWxzZQogICAgIHsKICAgICAgICAgc3dpdGNoKHBpeF9mbXQpCkBA
IC0xMTIzLDE4ICsxMTI2LDE4IEBAIE1PRF9pbml0CiAgICAgICAgICAgICBjYXNlIENPREVDX1JH
QjoKICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICBpZihpc19tanBlZykKLSAgICAgICAg
ICAgICAgICAgICAgbGF2Y192ZW5jX2NvbnRleHQtPnBpeF9mbXQgPSBQSVhfRk1UX1lVVko0MjBQ
OworICAgICAgICAgICAgICAgICAgICBsYXZjX3ZlbmNfY29udGV4dC0+cGl4X2ZtdCA9IEFWX1BJ
WF9GTVRfWVVWSjQyMFA7CiAgICAgICAgICAgICAgICAgZWxzZQotICAgICAgICAgICAgICAgICAg
ICBsYXZjX3ZlbmNfY29udGV4dC0+cGl4X2ZtdCA9IFBJWF9GTVRfWVVWNDIwUDsKKyAgICAgICAg
ICAgICAgICAgICAgbGF2Y192ZW5jX2NvbnRleHQtPnBpeF9mbXQgPSBBVl9QSVhfRk1UX1lVVjQy
MFA7CiAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICB9CiAKICAgICAgICAgICAg
IGNhc2UgQ09ERUNfWVVWNDIyOgogICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIGlmKGlz
X21qcGVnKQotICAgICAgICAgICAgICAgICAgICBsYXZjX3ZlbmNfY29udGV4dC0+cGl4X2ZtdCA9
IFBJWF9GTVRfWVVWSjQyMlA7CisgICAgICAgICAgICAgICAgICAgIGxhdmNfdmVuY19jb250ZXh0
LT5waXhfZm10ID0gQVZfUElYX0ZNVF9ZVVZKNDIyUDsKICAgICAgICAgICAgICAgICBlbHNlCi0g
ICAgICAgICAgICAgICAgICAgIGxhdmNfdmVuY19jb250ZXh0LT5waXhfZm10ID0gUElYX0ZNVF9Z
VVY0MjJQOworICAgICAgICAgICAgICAgICAgICBsYXZjX3ZlbmNfY29udGV4dC0+cGl4X2ZtdCA9
IEFWX1BJWF9GTVRfWVVWNDIyUDsKICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg
IH0KIApAQCAtMTU5Niw2ICsxNTk5LDggQEAgTU9EX2VuY29kZQogCiAgIGludCBvdXRfc2l6ZTsK
ICAgY29uc3QgY2hhciBwaWN0X3R5cGVfY2hhcls1XT0geyc/JywgJ0knLCAnUCcsICdCJywgJ1Mn
fTsKKyAgQVZQYWNrZXQgcGt0OworICBpbnQgcmV0LCBnb3RfcGFja2V0ID0gMDsKIAogICBpZiAo
cGFyYW0tPmZsYWcgPT0gVENfVklERU8pIHsKIApAQCAtMTYyMCw3ICsxNjI1LDcgQEAgTU9EX2Vu
Y29kZQogCSAgICAgICAgCVlVVl9JTklUX1BMQU5FUyhzcmMsIHBhcmFtLT5idWZmZXIsIElNR19Z
VVZfREVGQVVMVCwKIAkJCSAgICAgICAgICAgICAgICAJbGF2Y192ZW5jX2NvbnRleHQtPndpZHRo
LCBsYXZjX3ZlbmNfY29udGV4dC0+aGVpZ2h0KTsKICAgICAgICAgICAgICAgICBhdnBpY3R1cmVf
ZmlsbCgoQVZQaWN0dXJlICopbGF2Y192ZW5jX2ZyYW1lLCBpbWdfYnVmZmVyLAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIFBJWF9GTVRfWVVWNDIyUCwgbGF2Y192ZW5jX2NvbnRleHQt
PndpZHRoLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFWX1BJWF9GTVRfWVVWNDIy
UCwgbGF2Y192ZW5jX2NvbnRleHQtPndpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGxhdmNfdmVuY19jb250ZXh0LT5oZWlnaHQpOwogICAgICAgICAJCS8qIEZJWE1FOiBjYW4n
dCB1c2UgdGN2X2NvbnZlcnQgKHNlZSBkZWNvZGVfbGF2Yy5jKSAqLwogICAgICAgICAgICAgICAg
IGFjX2ltZ2NvbnZlcnQoc3JjLCBJTUdfWVVWX0RFRkFVTFQsCkBAIC0xNjUwLDcgKzE2NTUsNyBA
QCBNT0RfZW5jb2RlCiAJCSAgICAgICAgICAgICAgICAJCWxhdmNfdmVuY19jb250ZXh0LT53aWR0
aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF2Y192ZW5jX2NvbnRleHQtPmhl
aWdodCk7CiAgICAgICAgICAgICAgICAgYXZwaWN0dXJlX2ZpbGwoKEFWUGljdHVyZSAqKWxhdmNf
dmVuY19mcmFtZSwgaW1nX2J1ZmZlciwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQ
SVhfRk1UX1lVVjQyMFAsIGxhdmNfdmVuY19jb250ZXh0LT53aWR0aCwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBBVl9QSVhfRk1UX1lVVjQyMFAsIGxhdmNfdmVuY19jb250ZXh0LT53
aWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXZjX3ZlbmNfY29udGV4dC0+
aGVpZ2h0KTsKICAgICAgICAgICAgICAgICBhY19pbWdjb252ZXJ0KHNyYywgSU1HX1lVVjQyMlAs
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXZjX3ZlbmNfZnJhbWUtPmRhdGEsIElN
R19ZVVY0MjBQLApAQCAtMTY2MSw3ICsxNjY2LDcgQEAgTU9EX2VuY29kZQogCiAgICAgICAgIGNh
c2UgQ09ERUNfUkdCOgogICAgICAgICAgICAgYXZwaWN0dXJlX2ZpbGwoKEFWUGljdHVyZSAqKWxh
dmNfdmVuY19mcmFtZSwgaW1nX2J1ZmZlciwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgIFBJ
WF9GTVRfWVVWNDIwUCwgbGF2Y192ZW5jX2NvbnRleHQtPndpZHRoLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgQVZfUElYX0ZNVF9ZVVY0MjBQLCBsYXZjX3ZlbmNfY29udGV4dC0+d2lkdGgs
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXZjX3ZlbmNfY29udGV4dC0+aGVpZ2h0KTsK
ICAgICAJICAgIGFjX2ltZ2NvbnZlcnQoJnBhcmFtLT5idWZmZXIsIElNR19SR0JfREVGQVVMVCwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhdmNfdmVuY19mcmFtZS0+ZGF0YSwgSU1H
X1lVVjQyMFAsCkBAIC0xNjc0LDEzICsxNjc5LDE3IEBAIE1PRF9lbmNvZGUKICAgICAgICAgICAg
ICAgcmV0dXJuIFRDX0VYUE9SVF9FUlJPUjsKICAgICB9CiAKKyAgICBhdl9pbml0X3BhY2tldCgm
cGt0KTsKKyAgICBwa3QuZGF0YSA9IGVuY19idWZmZXI7CisgICAgcGt0LnNpemUgPSBzaXplOwog
CiAgICAgVENfTE9DS19MSUJBVkNPREVDOwotICAgIG91dF9zaXplID0gYXZjb2RlY19lbmNvZGVf
dmlkZW8obGF2Y192ZW5jX2NvbnRleHQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBlbmNfYnVmZmVyLCBzaXplLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgbGF2Y192ZW5jX2ZyYW1lKTsKKyAgICByZXQgPSBhdmNvZGVjX2VuY29kZV92aWRlbzIobGF2
Y192ZW5jX2NvbnRleHQsICZwa3QsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBsYXZjX3ZlbmNfZnJhbWUsICZnb3RfcGFja2V0KTsKICAgICBUQ19VTkxPQ0tfTElCQVZDT0RF
QzsKIAorICAgIG91dF9zaXplID0gcmV0ID8gcmV0IDogcGt0LnNpemU7CisKICAgICBpZiAob3V0
X3NpemUgPCAwKSB7CiAgICAgICB0Y19sb2dfd2FybihNT0RfTkFNRSwgImVuY29kZXIgZXJyb3I6
IHNpemUgKCVkKSIsIG91dF9zaXplKTsKICAgICAgIHJldHVybiBUQ19FWFBPUlRfRVJST1I7Cklu
ZGV4OiB0cmFuc2NvZGUtMS4xLjcvaW1wb3J0L2RlY29kZV9sYXZjLmMKPT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQotLS0g
dHJhbnNjb2RlLTEuMS43Lm9yaWcvaW1wb3J0L2RlY29kZV9sYXZjLmMKKysrIHRyYW5zY29kZS0x
LjEuNy9pbXBvcnQvZGVjb2RlX2xhdmMuYwpAQCAtMzI3LDggKzMyNyw4IEBAIHZvaWQgZGVjb2Rl
X2xhdmMoZGVjb2RlX3QgKmRlY29kZSkKIAogICAgICAgLy8gQ29udmVydCBhdmNvZGVjIGltYWdl
IHRvIHRoZSByZXF1ZXN0ZWQgWVVWIG9yIFJHQiBmb3JtYXQKICAgICAgIHN3aXRjaCAobGF2Y19k
ZWNfY29udGV4dC0+cGl4X2ZtdCkgewotCWNhc2UgUElYX0ZNVF9ZVVZKNDIwUDoKLQljYXNlIFBJ
WF9GTVRfWVVWNDIwUDoKKwljYXNlIEFWX1BJWF9GTVRfWVVWSjQyMFA6CisJY2FzZSBBVl9QSVhf
Rk1UX1lVVjQyMFA6CiAJICAgIC8vIFJlbW92ZSAiZGVhZCBzcGFjZSIgYXQgcmlnaHQgZWRnZSBv
ZiBwbGFuZXMsIGlmIGFueQogCSAgICBpZiAocGljdHVyZS5saW5lc2l6ZVswXSAhPSBsYXZjX2Rl
Y19jb250ZXh0LT53aWR0aCkgewogCQlpbnQgeTsKQEAgLTM1Miw3ICszNTIsNyBAQCB2b2lkIGRl
Y29kZV9sYXZjKGRlY29kZV90ICpkZWNvZGUpCiAJCQkgIHBpeF9mbXQ9PVRDX0NPREVDX1lVVjQy
MFAgPyBJTUdfWVVWNDIwUCA6IElNR19SR0JfREVGQVVMVCwKIAkJCSAgbGF2Y19kZWNfY29udGV4
dC0+d2lkdGgsIGxhdmNfZGVjX2NvbnRleHQtPmhlaWdodCk7CiAJICAgIGJyZWFrOwotCWNhc2Ug
UElYX0ZNVF9ZVVY0MTFQOgorCWNhc2UgQVZfUElYX0ZNVF9ZVVY0MTFQOgogCSAgICBpZiAocGlj
dHVyZS5saW5lc2l6ZVswXSAhPSBsYXZjX2RlY19jb250ZXh0LT53aWR0aCkgewogCQlpbnQgeTsK
IAkJZm9yICh5ID0gMDsgeSA8IGxhdmNfZGVjX2NvbnRleHQtPmhlaWdodDsgeSsrKSB7CkBAIC0z
NzEsOCArMzcxLDggQEAgdm9pZCBkZWNvZGVfbGF2YyhkZWNvZGVfdCAqZGVjb2RlKQogCQkJICBw
aXhfZm10PT1UQ19DT0RFQ19ZVVY0MjBQID8gSU1HX1lVVjQyMFAgOiBJTUdfUkdCX0RFRkFVTFQs
CiAJCQkgIGxhdmNfZGVjX2NvbnRleHQtPndpZHRoLCBsYXZjX2RlY19jb250ZXh0LT5oZWlnaHQp
OwogCSAgICBicmVhazsKLQljYXNlIFBJWF9GTVRfWVVWSjQyMlA6Ci0JY2FzZSBQSVhfRk1UX1lV
VjQyMlA6CisJY2FzZSBBVl9QSVhfRk1UX1lVVko0MjJQOgorCWNhc2UgQVZfUElYX0ZNVF9ZVVY0
MjJQOgogCSAgICBpZiAocGljdHVyZS5saW5lc2l6ZVswXSAhPSBsYXZjX2RlY19jb250ZXh0LT53
aWR0aCkgewogCQlpbnQgeTsKIAkJZm9yICh5ID0gMDsgeSA8IGxhdmNfZGVjX2NvbnRleHQtPmhl
aWdodDsgeSsrKSB7CkBAIC0zOTEsOCArMzkxLDggQEAgdm9pZCBkZWNvZGVfbGF2YyhkZWNvZGVf
dCAqZGVjb2RlKQogCQkJICBwaXhfZm10PT1UQ19DT0RFQ19ZVVY0MjBQID8gSU1HX1lVVjQyMFAg
OiBJTUdfUkdCX0RFRkFVTFQsCiAJCQkgIGxhdmNfZGVjX2NvbnRleHQtPndpZHRoLCBsYXZjX2Rl
Y19jb250ZXh0LT5oZWlnaHQpOwogCSAgICBicmVhazsKLQljYXNlIFBJWF9GTVRfWVVWSjQ0NFA6
Ci0JY2FzZSBQSVhfRk1UX1lVVjQ0NFA6CisJY2FzZSBBVl9QSVhfRk1UX1lVVko0NDRQOgorCWNh
c2UgQVZfUElYX0ZNVF9ZVVY0NDRQOgogCSAgICBpZiAocGljdHVyZS5saW5lc2l6ZVswXSAhPSBs
YXZjX2RlY19jb250ZXh0LT53aWR0aCkgewogCQlpbnQgeTsKIAkJZm9yICh5ID0gMDsgeSA8IGxh
dmNfZGVjX2NvbnRleHQtPmhlaWdodDsgeSsrKSB7CkluZGV4OiB0cmFuc2NvZGUtMS4xLjcvaW1w
b3J0L2ltcG9ydF9mZm1wZWcuYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci0tLSB0cmFuc2NvZGUtMS4xLjcub3JpZy9p
bXBvcnQvaW1wb3J0X2ZmbXBlZy5jCisrKyB0cmFuc2NvZGUtMS4xLjcvaW1wb3J0L2ltcG9ydF9m
Zm1wZWcuYwpAQCAtNjYxLDggKzY2MSw4IEBAIHJldHJ5OgogCiAgICAgLy8gQ29udmVydCBhdmNv
ZGVjIGltYWdlIHRvIG91ciBpbnRlcm5hbCBZVVYgb3IgUkdCIGZvcm1hdAogICAgIHN3aXRjaCAo
bGF2Y19kZWNfY29udGV4dC0+cGl4X2ZtdCkgewotICAgICAgY2FzZSBQSVhfRk1UX1lVVko0MjBQ
OgotICAgICAgY2FzZSBQSVhfRk1UX1lVVjQyMFA6CisgICAgICBjYXNlIEFWX1BJWF9GTVRfWVVW
SjQyMFA6CisgICAgICBjYXNlIEFWX1BJWF9GTVRfWVVWNDIwUDoKICAgICAgICAgc3JjX2ZtdCA9
IElNR19ZVVY0MjBQOwogICAgICAgICBZVVZfSU5JVF9QTEFORVMoc3JjX3BsYW5lcywgZnJhbWUs
IHNyY19mbXQsCiAgICAgICAgICAgICAgICAgICAgICAgICBsYXZjX2RlY19jb250ZXh0LT53aWR0
aCwgbGF2Y19kZWNfY29udGV4dC0+aGVpZ2h0KTsKQEAgLTY5Myw3ICs2OTMsNyBAQCByZXRyeToK
IAl9CiAgICAgICAgIGJyZWFrOwogCi0gICAgICBjYXNlIFBJWF9GTVRfWVVWNDExUDoKKyAgICAg
IGNhc2UgQVZfUElYX0ZNVF9ZVVY0MTFQOgogICAgICAgICBzcmNfZm10ID0gSU1HX1lVVjQxMVA7
CiAgICAgICAgIFlVVl9JTklUX1BMQU5FUyhzcmNfcGxhbmVzLCBmcmFtZSwgc3JjX2ZtdCwKICAg
ICAgICAgICAgICAgICAgICAgICAgIGxhdmNfZGVjX2NvbnRleHQtPndpZHRoLCBsYXZjX2RlY19j
b250ZXh0LT5oZWlnaHQpOwpAQCAtNzIxLDggKzcyMSw4IEBAIHJldHJ5OgogICAgICAgICB9CiAg
ICAgICAgIGJyZWFrOwogCi0gICAgICBjYXNlIFBJWF9GTVRfWVVWSjQyMlA6Ci0gICAgICBjYXNl
IFBJWF9GTVRfWVVWNDIyUDoKKyAgICAgIGNhc2UgQVZfUElYX0ZNVF9ZVVZKNDIyUDoKKyAgICAg
IGNhc2UgQVZfUElYX0ZNVF9ZVVY0MjJQOgogICAgICAgICBzcmNfZm10ID0gSU1HX1lVVjQyMlA7
CiAgICAgICAgIFlVVl9JTklUX1BMQU5FUyhzcmNfcGxhbmVzLCBmcmFtZSwgc3JjX2ZtdCwKICAg
ICAgICAgICAgICAgICAgICAgICAgIGxhdmNfZGVjX2NvbnRleHQtPndpZHRoLCBsYXZjX2RlY19j
b250ZXh0LT5oZWlnaHQpOwpAQCAtNzUwLDggKzc1MCw4IEBAIHJldHJ5OgogICAgICAgICB9CiAJ
YnJlYWs7CiAKLSAgICAgIGNhc2UgUElYX0ZNVF9ZVVZKNDQ0UDoKLSAgICAgIGNhc2UgUElYX0ZN
VF9ZVVY0NDRQOgorICAgICAgY2FzZSBBVl9QSVhfRk1UX1lVVko0NDRQOgorICAgICAgY2FzZSBB
Vl9QSVhfRk1UX1lVVjQ0NFA6CiAgICAgICAgIHNyY19mbXQgPSBJTUdfWVVWNDQ0UDsKICAgICAg
ICAgWVVWX0lOSVRfUExBTkVTKHNyY19wbGFuZXMsIGZyYW1lLCBzcmNfZm10LAogICAgICAgICAg
ICAgICAgICAgICAgICAgbGF2Y19kZWNfY29udGV4dC0+d2lkdGgsIGxhdmNfZGVjX2NvbnRleHQt
PmhlaWdodCk7Cg==
" | base64 -d > $TMP/transcode-1.1.7-ffmpeg29.patch
patch -p1 -i $TMP/transcode-1.1.7-ffmpeg29.patch || exit 1

echo "
LS0tIHRyYW5zY29kZS0xLjEuNy9leHBvcnQvYXVkX2F1eC5jLm9yaWcJMjAxNi0wMi0xNiAyMzoz
ODo0MC4xNjI2OTA3ODkgKzAwMDAKKysrIHRyYW5zY29kZS0xLjEuNy9leHBvcnQvYXVkX2F1eC5j
CTIwMTYtMDItMTYgMjM6NDA6NTAuMzM1NDg4NDM5ICswMDAwCkBAIC0zMjYsMTAgKzMyNiwxMCBA
QAogCiAgICAgc3dpdGNoIChvX2NvZGVjKSB7CiAgICAgICBjYXNlICAgMHg1MDoKLSAgICAgICAg
Y29kZWlkID0gQ09ERUNfSURfTVAyOworICAgICAgICBjb2RlaWQgPSBBVl9DT0RFQ19JRF9NUDI7
CiAgICAgICAgIGJyZWFrOwogICAgICAgY2FzZSAweDIwMDA6Ci0gICAgICAgIGNvZGVpZCA9IENP
REVDX0lEX0FDMzsKKyAgICAgICAgY29kZWlkID0gQVZfQ09ERUNfSURfQUMzOwogICAgICAgICBi
cmVhazsKICAgICAgIGRlZmF1bHQ6CiAgICAgICAgIHRjX3dhcm4oImNhbm5vdCBpbml0IGZmbXBl
ZyB3aXRoICV4Iiwgb19jb2RlYyk7CkBAIC0zNjMsNyArMzYzLDcgQEAKICAgICBUQ19VTkxPQ0tf
TElCQVZDT0RFQzsKICAgICBpZiAocmV0IDwgMCkgewogICAgICAgICB0Y193YXJuKCJ0Y19hdWRp
b19pbml0X2ZmbXBlZzogY291bGQgbm90IG9wZW4gJXMgY29kZWMgISIsCi0gICAgICAgICAgICAg
ICAgKGNvZGVpZCA9PSBDT0RFQ19JRF9NUDIpID8ibXBhIiA6ImFjMyIpOworICAgICAgICAgICAg
ICAgIChjb2RlaWQgPT0gQVZfQ09ERUNfSURfTVAyKSA/Im1wYSIgOiJhYzMiKTsKICAgICAgICAg
cmV0dXJuKFRDX0VYUE9SVF9FUlJPUik7CiAgICAgfQogCi0tLSB0cmFuc2NvZGUtMS4xLjcvaW1w
b3J0L2ltcG9ydF9mZm1wZWcuYy5vcmlnCTIwMTYtMDItMTYgMjM6NTI6MzYuMTkyNTg5NjQ4ICsw
MDAwCisrKyB0cmFuc2NvZGUtMS4xLjcvaW1wb3J0L2ltcG9ydF9mZm1wZWcuYwkyMDE2LTAyLTE2
IDIzOjU0OjM4LjcyODc1NzQ5OCArMDAwMApAQCAtNTksNTEgKzU5LDUxIEBACiAKIC8vIGZvdXJD
QyB0byBJRCBtYXBwaW5nIHRha2VuIGZyb20gTVBsYXllcidzIGNvZGVjcy5jb25mCiBzdGF0aWMg
c3RydWN0IGZmbXBlZ19jb2RlYyBmZm1wZWdfY29kZWNzW10gPSB7Ci0gIHtDT0RFQ19JRF9NU01Q
RUc0VjEsIFRDX0NPREVDX0VSUk9SLCAibXA0MSIsCisgIHtBVl9DT0RFQ19JRF9NU01QRUc0VjEs
IFRDX0NPREVDX0VSUk9SLCAibXA0MSIsCiAgICAgeyJNUDQxIiwgIkRJVjEiLCAiIn19LAotICB7
Q09ERUNfSURfTVNNUEVHNFYyLCBUQ19DT0RFQ19NUDQyLCAibXA0MiIsCisgIHtBVl9DT0RFQ19J
RF9NU01QRUc0VjIsIFRDX0NPREVDX01QNDIsICJtcDQyIiwKICAgICB7Ik1QNDIiLCAiRElWMiIs
ICIifX0sCi0gIHtDT0RFQ19JRF9NU01QRUc0VjMsIFRDX0NPREVDX0RJVlgzLCAibXNtcGVnNCIs
CisgIHtBVl9DT0RFQ19JRF9NU01QRUc0VjMsIFRDX0NPREVDX0RJVlgzLCAibXNtcGVnNCIsCiAg
ICAgeyJESVYzIiwgIkRJVjUiLCAiQVA0MSIsICJNUEczIiwgIk1QNDMiLCAiIn19LAotICB7Q09E
RUNfSURfTVBFRzQsIFRDX0NPREVDX0RJVlg0LCAibXBlZzQiLAorICB7QVZfQ09ERUNfSURfTVBF
RzQsIFRDX0NPREVDX0RJVlg0LCAibXBlZzQiLAogICAgIHsiRElWWCIsICJYVklEIiwgIk1QNFMi
LCAiTTRTMiIsICJNUDRWIiwgIlVNUDQiLCAiRFg1MCIsICIifX0sCi0gIHtDT0RFQ19JRF9NSlBF
RywgVENfQ09ERUNfTUpQRUcsICJtanBlZyIsCisgIHtBVl9DT0RFQ19JRF9NSlBFRywgVENfQ09E
RUNfTUpQRUcsICJtanBlZyIsCiAgICAgeyJNSlBHIiwgIkFWUk4iLCAiQVZESiIsICJKUEVHIiwg
Ik1KUEEiLCAiSkZJRiIsICIifX0sCi0gIHtDT0RFQ19JRF9NUEVHMVZJREVPLCBUQ19DT0RFQ19N
UEcxLCAibXBlZzF2aWRlbyIsCisgIHtBVl9DT0RFQ19JRF9NUEVHMVZJREVPLCBUQ19DT0RFQ19N
UEcxLCAibXBlZzF2aWRlbyIsCiAgICAgeyJNUEcxIiwgIiJ9fSwKLSAge0NPREVDX0lEX0RWVklE
RU8sIFRDX0NPREVDX0RWLCAiZHZ2aWRlbyIsCisgIHtBVl9DT0RFQ19JRF9EVlZJREVPLCBUQ19D
T0RFQ19EViwgImR2dmlkZW8iLAogICAgIHsiRFZTRCIsICIifX0sCi0gIHtDT0RFQ19JRF9XTVYx
LCBUQ19DT0RFQ19XTVYxLCAid212MSIsCisgIHtBVl9DT0RFQ19JRF9XTVYxLCBUQ19DT0RFQ19X
TVYxLCAid212MSIsCiAgICAgeyJXTVYxIiwgIiJ9fSwKLSAge0NPREVDX0lEX1dNVjIsIFRDX0NP
REVDX1dNVjIsICJ3bXYyIiwKKyAge0FWX0NPREVDX0lEX1dNVjIsIFRDX0NPREVDX1dNVjIsICJ3
bXYyIiwKICAgICB7IldNVjIiLCAiIn19LAotICB7Q09ERUNfSURfSFVGRllVViwgVENfQ09ERUNf
SFVGRllVViwgImhmeXUiLAorICB7QVZfQ09ERUNfSURfSFVGRllVViwgVENfQ09ERUNfSFVGRllV
ViwgImhmeXUiLAogICAgIHsiSEZZVSIsICIifX0sCi0gIHtDT0RFQ19JRF9IMjYzSSwgVENfQ09E
RUNfSDI2M0ksICJoMjYzaSIsCisgIHtBVl9DT0RFQ19JRF9IMjYzSSwgVENfQ09ERUNfSDI2M0ks
ICJoMjYzaSIsCiAgICAgeyJJMjYzIiwgIiJ9fSwKLSAge0NPREVDX0lEX0gyNjNQLCBUQ19DT0RF
Q19IMjYzUCwgImgyNjNwIiwKKyAge0FWX0NPREVDX0lEX0gyNjNQLCBUQ19DT0RFQ19IMjYzUCwg
ImgyNjNwIiwKICAgICB7IkgyNjMiLCAiVTI2MyIsICJWSVYxIiwgIiJ9fSwKLSAge0NPREVDX0lE
X0gyNjQsIFRDX0NPREVDX0gyNjQsICJoMjY0IiwKKyAge0FWX0NPREVDX0lEX0gyNjQsIFRDX0NP
REVDX0gyNjQsICJoMjY0IiwKICAgICB7IkgyNjQiLCAiaDI2NCIsICJYMjY0IiwgIngyNjQiLCAi
YXZjMSIsICIifX0sCi0gIHtDT0RFQ19JRF9SVjEwLCBUQ19DT0RFQ19SVjEwLCAicnYxMCIsCisg
IHtBVl9DT0RFQ19JRF9SVjEwLCBUQ19DT0RFQ19SVjEwLCAicnYxMCIsCiAgICAgeyJSVjEwIiwg
IlJWMTMiLCAiIn19LAotICB7Q09ERUNfSURfU1ZRMSwgVENfQ09ERUNfU1ZRMSwgInN2cTEiLAor
ICB7QVZfQ09ERUNfSURfU1ZRMSwgVENfQ09ERUNfU1ZRMSwgInN2cTEiLAogICAgIHsiU1ZRMSIs
ICIifX0sCi0gIHtDT0RFQ19JRF9TVlEzLCBUQ19DT0RFQ19TVlEzLCAic3ZxMyIsCisgIHtBVl9D
T0RFQ19JRF9TVlEzLCBUQ19DT0RFQ19TVlEzLCAic3ZxMyIsCiAgICAgeyJTVlEzIiwgIiJ9fSwK
LSAge0NPREVDX0lEX01QRUcyVklERU8sIFRDX0NPREVDX01QRUcyLCAibXBlZzJ2aWRlbyIsCisg
IHtBVl9DT0RFQ19JRF9NUEVHMlZJREVPLCBUQ19DT0RFQ19NUEVHMiwgIm1wZWcydmlkZW8iLAog
ICAgIHsiTVBHMiIsICIifX0sCi0gIHtDT0RFQ19JRF9NUEVHMlZJREVPLCBUQ19DT0RFQ19NUEVH
LCAibXBlZzJ2aWRlbyIsCisgIHtBVl9DT0RFQ19JRF9NUEVHMlZJREVPLCBUQ19DT0RFQ19NUEVH
LCAibXBlZzJ2aWRlbyIsCiAgICAgeyJNUEcyIiwgIiJ9fSwKLSAge0NPREVDX0lEX0FTVjEsIFRD
X0NPREVDX0FTVjEsICJhc3YxIiwKKyAge0FWX0NPREVDX0lEX0FTVjEsIFRDX0NPREVDX0FTVjEs
ICJhc3YxIiwKICAgICB7IkFTVjEiLCAiIn19LAotICB7Q09ERUNfSURfQVNWMiwgVENfQ09ERUNf
QVNWMiwgImFzdjIiLAorICB7QVZfQ09ERUNfSURfQVNWMiwgVENfQ09ERUNfQVNWMiwgImFzdjIi
LAogICAgIHsiQVNWMiIsICIifX0sCi0gIHtDT0RFQ19JRF9GRlYxLCBUQ19DT0RFQ19GRlYxLCAi
ZmZ2MSIsCisgIHtBVl9DT0RFQ19JRF9GRlYxLCBUQ19DT0RFQ19GRlYxLCAiZmZ2MSIsCiAgICAg
eyJGRlYxIiwgIiJ9fSwKLSAge0NPREVDX0lEX1JBV1ZJREVPLCBUQ19DT0RFQ19ZVVY0MjBQLCAi
cmF3IiwKKyAge0FWX0NPREVDX0lEX1JBV1ZJREVPLCBUQ19DT0RFQ19ZVVY0MjBQLCAicmF3IiwK
ICAgICB7Ikk0MjAiLCAiSVlVViIsICIifX0sCi0gIHtDT0RFQ19JRF9SQVdWSURFTywgVENfQ09E
RUNfWVVWNDIyUCwgInJhdyIsCisgIHtBVl9DT0RFQ19JRF9SQVdWSURFTywgVENfQ09ERUNfWVVW
NDIyUCwgInJhdyIsCiAgICAgeyJZNDJCIiwgIiJ9fSwKICAgezAsIFRDX0NPREVDX1VOS05PV04s
IE5VTEwsIHsiIn19fTsKIApAQCAtMzI0LDEzICszMjQsMTMgQEAKICAgICAvLyBYWFg6IHNvbWUg
Y29kZWNzIG5lZWQgZXh0cmEgZGF0YQogICAgIHN3aXRjaCAoY29kZWMtPmlkKQogICAgIHsKLSAg
ICAgIGNhc2UgQ09ERUNfSURfTUpQRUc6IGV4dHJhX2RhdGFfc2l6ZSAgPSAyODsgYnJlYWs7Ci0g
ICAgICBjYXNlIENPREVDX0lEX0xKUEVHOiBleHRyYV9kYXRhX3NpemUgID0gMjg7IGJyZWFrOwot
ICAgICAgY2FzZSBDT0RFQ19JRF9IVUZGWVVWOiBleHRyYV9kYXRhX3NpemUgPSAxMDAwOyBicmVh
azsKLSAgICAgIGNhc2UgQ09ERUNfSURfQVNWMTogZXh0cmFfZGF0YV9zaXplID0gODsgYnJlYWs7
Ci0gICAgICBjYXNlIENPREVDX0lEX0FTVjI6IGV4dHJhX2RhdGFfc2l6ZSA9IDg7IGJyZWFrOwot
ICAgICAgY2FzZSBDT0RFQ19JRF9XTVYxOiBleHRyYV9kYXRhX3NpemUgPSA0OyBicmVhazsKLSAg
ICAgIGNhc2UgQ09ERUNfSURfV01WMjogZXh0cmFfZGF0YV9zaXplID0gNDsgYnJlYWs7CisgICAg
ICBjYXNlIEFWX0NPREVDX0lEX01KUEVHOiBleHRyYV9kYXRhX3NpemUgID0gMjg7IGJyZWFrOwor
ICAgICAgY2FzZSBBVl9DT0RFQ19JRF9MSlBFRzogZXh0cmFfZGF0YV9zaXplICA9IDI4OyBicmVh
azsKKyAgICAgIGNhc2UgQVZfQ09ERUNfSURfSFVGRllVVjogZXh0cmFfZGF0YV9zaXplID0gMTAw
MDsgYnJlYWs7CisgICAgICBjYXNlIEFWX0NPREVDX0lEX0FTVjE6IGV4dHJhX2RhdGFfc2l6ZSA9
IDg7IGJyZWFrOworICAgICAgY2FzZSBBVl9DT0RFQ19JRF9BU1YyOiBleHRyYV9kYXRhX3NpemUg
PSA4OyBicmVhazsKKyAgICAgIGNhc2UgQVZfQ09ERUNfSURfV01WMTogZXh0cmFfZGF0YV9zaXpl
ID0gNDsgYnJlYWs7CisgICAgICBjYXNlIEFWX0NPREVDX0lEX1dNVjI6IGV4dHJhX2RhdGFfc2l6
ZSA9IDQ7IGJyZWFrOwogICAgICAgZGVmYXVsdDogZXh0cmFfZGF0YV9zaXplID0gMDsgYnJlYWs7
CiAgICAgfQogCkBAIC0zNjAsNyArMzYwLDcgQEAKICAgICAgICAgZnJhbWVfc2l6ZSA9IHhfZGlt
KnlfZGltICsgMipVVl9QTEFORV9TSVpFKElNR19ZVVZfREVGQVVMVCx4X2RpbSx5X2RpbSk7CiAK
IAkvLyB3ZSBhZGFwdCB0aGUgY29sb3Igc3BhY2UKLSAgICAgICAgaWYoY29kZWMtPmlkID09IENP
REVDX0lEX01KUEVHKSB7CisgICAgICAgIGlmKGNvZGVjLT5pZCA9PSBBVl9DT0RFQ19JRF9NSlBF
RykgewogCSAgZW5hYmxlX2xldmVsc19maWx0ZXIoKTsKICAgICAgICAgfQogICAgICAgICBicmVh
azsKQEAgLTQzNCw3ICs0MzQsNyBAQAogICAgICAgfQogCiAgICAgICAvLyB3ZSBhZGFwdCB0aGUg
Y29sb3Igc3BhY2UKLSAgICAgIGlmKGNvZGVjLT5pZCA9PSBDT0RFQ19JRF9NSlBFRykgeworICAg
ICAgaWYoY29kZWMtPmlkID09IEFWX0NPREVDX0lEX01KUEVHKSB7CiAgICAgICAgIGVuYWJsZV9s
ZXZlbHNfZmlsdGVyKCk7CiAgICAgICB9CiAKQEAgLTUwNCwxMyArNTA0LDEzIEBACiAgICAgICBp
bnQgYmtleSA9IDA7CiAKICAgICAgIC8vIGNoZWNrIGZvciBrZXlmcmFtZXMKLSAgICAgIGlmIChj
b2RlYy0+aWQgPT0gQ09ERUNfSURfTVNNUEVHNFYzKSB7CisgICAgICBpZiAoY29kZWMtPmlkID09
IEFWX0NPREVDX0lEX01TTVBFRzRWMykgewogCWlmIChkaXZ4M19pc19rZXkoYnVmZmVyKSkgYmtl
eSA9IDE7CiAgICAgICB9Ci0gICAgICBlbHNlIGlmIChjb2RlYy0+aWQgPT0gQ09ERUNfSURfTVBF
RzQpIHsKKyAgICAgIGVsc2UgaWYgKGNvZGVjLT5pZCA9PSBBVl9DT0RFQ19JRF9NUEVHNCkgewog
CWlmIChtcGVnNF9pc19rZXkoYnVmZmVyLCBieXRlc19yZWFkKSkgYmtleSA9IDE7CiAgICAgICB9
Ci0gICAgICBlbHNlIGlmIChjb2RlYy0+aWQgPT0gQ09ERUNfSURfTUpQRUcpIHsKKyAgICAgIGVs
c2UgaWYgKGNvZGVjLT5pZCA9PSBBVl9DT0RFQ19JRF9NSlBFRykgewogCWJrZXkgPSAxOwogICAg
ICAgfQogCi0tLSB0cmFuc2NvZGUtMS4xLjcvaW1wb3J0L2RlY29kZV9sYXZjLmMub3JpZwkyMDE2
LTAyLTE2IDIzOjU2OjM1LjQ4ODI4MjAzNCArMDAwMAorKysgdHJhbnNjb2RlLTEuMS43L2ltcG9y
dC9kZWNvZGVfbGF2Yy5jCTIwMTYtMDItMTYgMjM6NTY6NTUuMjAxNTM1MDc0ICswMDAwCkBAIC01
OCwzNyArNTgsMzcgQEAKIAogLy8gZm91ckNDIHRvIElEIG1hcHBpbmcgdGFrZW4gZnJvbSBNUGxh
eWVyJ3MgY29kZWNzLmNvbmYKIHN0YXRpYyBzdHJ1Y3QgZmZtcGVnX2NvZGVjIGZmbXBlZ19jb2Rl
Y3NbXSA9IHsKLSAge0NPREVDX0lEX01TTVBFRzRWMSwgVENfQ09ERUNfRVJST1IsICJtcDQxIiwK
KyAge0FWX0NPREVDX0lEX01TTVBFRzRWMSwgVENfQ09ERUNfRVJST1IsICJtcDQxIiwKICAgICB7
Ik1QNDEiLCAiRElWMSIsICIifX0sCi0gIHtDT0RFQ19JRF9NU01QRUc0VjIsIFRDX0NPREVDX01Q
NDIsICJtcDQyIiwKKyAge0FWX0NPREVDX0lEX01TTVBFRzRWMiwgVENfQ09ERUNfTVA0MiwgIm1w
NDIiLAogICAgIHsiTVA0MiIsICJESVYyIiwgIiJ9fSwKLSAge0NPREVDX0lEX01TTVBFRzRWMywg
VENfQ09ERUNfRElWWDMsICJtc21wZWc0IiwKKyAge0FWX0NPREVDX0lEX01TTVBFRzRWMywgVENf
Q09ERUNfRElWWDMsICJtc21wZWc0IiwKICAgICB7IkRJVjMiLCAiRElWNSIsICJBUDQxIiwgIk1Q
RzMiLCAiTVA0MyIsICIifX0sCi0gIHtDT0RFQ19JRF9NUEVHNCwgVENfQ09ERUNfRElWWDQsICJt
cGVnNCIsCisgIHtBVl9DT0RFQ19JRF9NUEVHNCwgVENfQ09ERUNfRElWWDQsICJtcGVnNCIsCiAg
ICAgeyJESVZYIiwgIlhWSUQiLCAiTVA0UyIsICJNNFMyIiwgIk1QNFYiLCAiVU1QNCIsICJEWDUw
IiwgIiJ9fSwKLSAge0NPREVDX0lEX01KUEVHLCBUQ19DT0RFQ19NSlBFRywgIm1qcGVnIiwKKyAg
e0FWX0NPREVDX0lEX01KUEVHLCBUQ19DT0RFQ19NSlBFRywgIm1qcGVnIiwKICAgICB7Ik1KUEci
LCAiQVZSTiIsICJBVkRKIiwgIkpQRUciLCAiTUpQQSIsICJKRklGIiwgIiJ9fSwKLSAge0NPREVD
X0lEX01QRUcxVklERU8sIFRDX0NPREVDX01QRUcxVklERU8sICJtcGVnMXZpZGVvIiwKKyAge0FW
X0NPREVDX0lEX01QRUcxVklERU8sIFRDX0NPREVDX01QRUcxVklERU8sICJtcGVnMXZpZGVvIiwK
ICAgICB7Ik1QRzEiLCAiIn19LAotICB7Q09ERUNfSURfRFZWSURFTywgVENfQ09ERUNfRFYsICJk
dnZpZGVvIiwKKyAge0FWX0NPREVDX0lEX0RWVklERU8sIFRDX0NPREVDX0RWLCAiZHZ2aWRlbyIs
CiAgICAgeyJEVlNEIiwgIiJ9fSwKLSAge0NPREVDX0lEX1dNVjEsIFRDX0NPREVDX1dNVjEsICJ3
bXYxIiwKKyAge0FWX0NPREVDX0lEX1dNVjEsIFRDX0NPREVDX1dNVjEsICJ3bXYxIiwKICAgICB7
IldNVjEiLCAiIn19LAotICB7Q09ERUNfSURfV01WMiwgVENfQ09ERUNfV01WMiwgIndtdjIiLAor
ICB7QVZfQ09ERUNfSURfV01WMiwgVENfQ09ERUNfV01WMiwgIndtdjIiLAogICAgIHsiV01WMiIs
ICIifX0sCi0gIHtDT0RFQ19JRF9IVUZGWVVWLCBUQ19DT0RFQ19IVUZGWVVWLCAiaGZ5dSIsCisg
IHtBVl9DT0RFQ19JRF9IVUZGWVVWLCBUQ19DT0RFQ19IVUZGWVVWLCAiaGZ5dSIsCiAgICAgeyJI
RllVIiwgIiJ9fSwKLSAge0NPREVDX0lEX0gyNjNJLCBUQ19DT0RFQ19IMjYzSSwgImgyNjNpIiwK
KyAge0FWX0NPREVDX0lEX0gyNjNJLCBUQ19DT0RFQ19IMjYzSSwgImgyNjNpIiwKICAgICB7Ikky
NjMiLCAiIn19LAotICB7Q09ERUNfSURfSDI2M1AsIFRDX0NPREVDX0gyNjNQLCAiaDI2M3AiLAor
ICB7QVZfQ09ERUNfSURfSDI2M1AsIFRDX0NPREVDX0gyNjNQLCAiaDI2M3AiLAogICAgIHsiSDI2
MyIsICJVMjYzIiwgIlZJVjEiLCAiIn19LAotICB7Q09ERUNfSURfUlYxMCwgVENfQ09ERUNfUlYx
MCwgInJ2MTAiLAorICB7QVZfQ09ERUNfSURfUlYxMCwgVENfQ09ERUNfUlYxMCwgInJ2MTAiLAog
ICAgIHsiUlYxMCIsICJSVjEzIiwgIiJ9fSwKLSAge0NPREVDX0lEX1NWUTEsIFRDX0NPREVDX1NW
UTEsICJzdnExIiwKKyAge0FWX0NPREVDX0lEX1NWUTEsIFRDX0NPREVDX1NWUTEsICJzdnExIiwK
ICAgICB7IlNWUTEiLCAiIn19LAotICB7Q09ERUNfSURfU1ZRMywgVENfQ09ERUNfU1ZRMywgInN2
cTMiLAorICB7QVZfQ09ERUNfSURfU1ZRMywgVENfQ09ERUNfU1ZRMywgInN2cTMiLAogICAgIHsi
U1ZRMyIsICIifX0sCi0gIHtDT0RFQ19JRF9NUEVHMlZJREVPLCBUQ19DT0RFQ19NUEVHMiwgIm1w
ZWcydmlkZW8iLAorICB7QVZfQ09ERUNfSURfTVBFRzJWSURFTywgVENfQ09ERUNfTVBFRzIsICJt
cGVnMnZpZGVvIiwKICAgICB7Ik1QRzIiLCAiIn19LAogICB7MCwgVENfQ09ERUNfVU5LTk9XTiwg
TlVMTCwgeyIifX19OwogCg==
" | base64 -d > $TMP/transcode-ffmpeg3.patch
patch -p1 -i $TMP/transcode-ffmpeg3.patch || exit 1
fi

echo 
echo "$VERDE"Configurando paquete ..."$CIERRE"
sleep 1

CFLAGS="$SLKCFLAGS" \
CXXFLAGS="$SLKCFLAGS" \
LDFLAGS="-L/usr/lib${LIBDIRSUFFIX}" \
./configure \
  --prefix=/usr \
  --libdir=/usr/lib${LIBDIRSUFFIX} \
  --sysconfdir=/etc \
  --localstatedir=/var \
  --docdir=/usr/doc/$PRGNAM-$VERSION \
  --mandir=/usr/man \
  --enable-alsa \
  --enable-v4l \
  --enable-libv4l2=yes \
  --enable-libv4lconvert=yes \
  --enable-libmpeg2=yes \
  --enable-libmpeg2convert=yes \
  --enable-ogg \
  --enable-vorbis \
  --enable-theora \
  --enable-x264=yes \
  --enable-xvid=yes \
  --enable-faac=yes \
  --enable-freetype2 \
  --enable-sdl \
  --enable-libxml2 \
  --enable-libdv=yes \
  --enable-libquicktime=yes \
  --enable-mjpegtools=yes \
  --enable-a52=yes \
  --enable-lame=yes \
  --enable-nuv \
  --enable-lzo \
  --enable-libpostproc \
  --enable-imagemagick \
  --build=$ARCH-slackware-linux
  
echo 
echo "$VERDE"Compilando paquete ..."$CIERRE"
sleep 1

make  || exit 1
make install-strip DESTDIR=$PKG || exit 1

# Install headers
mkdir -p $PKG/usr/include/transcode/{aclib,avilib,libtc,libtcaudio,libtcvideo}
install -m 644 src/*.h $PKG/usr/include/transcode/
install -m 644 aclib/*.h $PKG/usr/include/transcode/aclib/
install -m 644 avilib/*.h $PKG/usr/include/transcode/avilib/
install -m 644 libtc/*.h $PKG/usr/include/transcode/libtc/
install -m 644 libtcaudio/*.h $PKG/usr/include/transcode/libtcaudio/
install -m 644 libtcvideo/*.h $PKG/usr/include/transcode/libtcvideo/
install -m 644 config.h $PKG/usr/include/transcode/

# remove filters shipped by other packages
rm -f $PKG/usr/lib$LIBDIRSUFFIX/transcode/filter_{stabilize,transform}.*

# Hay un bug que no respeta el docdir y lo eliminamos a mano
if [ -d $PKG/usr/share/doc ]; then
rm -rf $PKG/usr/share/doc
fi
}

###################################
## BLOQUE PRINCIPAL DE EJECUCION ##
###################################
# Si se cierra el script inesperadamente, ejecutar la funcion de limpieza
trap f_exitmode SIGHUP SIGINT

#Inicializamos las variables globales
f_variables
#Comprobamos conexion a Internet
f_comprobarConexion
#Inicializamos las variables del script
F_variables
#Creamos directorio de trabajo
f_directorioTemporal
#Mostramos el mensaje de presentacion
f_presentacion
#Comprobamos updates del script
f_comprobarUpdates
#Asignamos o detectamos arquitectura
f_arquitectura
#Comprobamos version instalada del paquete
f_versionInstalada
# Comprobar dependencias
F_dependencias
#Si no existe el fichero se descargara
f_download
#Preparando entorno
f_preparar
#Descomprimir fichero descargado y compilamos
F_compilar
#Hacemos strip sobre el paquete
f_strip
#Creamos xzm , instalamos y salimos
f_tareasFinales