#!/bin/sh

# Script by www.seguridadwireless.net

SCRIPT_VERSION=20161005

############################################################
## Funciones comunes. Su nombre empieza por f_ ##
############################################################
f_variables(){
	. /opt/wifislax-updaters/Funciones/funciones_updater
}

############################################################
## Funciones propias del script. Su nombre empieza por F_ ##
############################################################
# Definicion de variables
F_variables() {
	PRGNAM=subterfuge
	echo -ne "\033]2;${PRGNAM}_updater\007"
	VERSION=1.0
	DOWNLOAD=https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/subterfuge/subterfuge_1.0-1_all.deb
}

# Creamos directorios extra
F_extradirs(){
mkdir -p $PKG/usr/share/{pixmaps,applications/wifislax/Testing}
}

# Comprobar dependencias
F_dependencias(){
DEPENDENCIAS="django"
f_dependencias
}

# Si el paquete no existe se descargara de internet
F_download(){
	if [ ! -f subterfuge_1.0-1_all.deb ]; then
	echo 
	echo "$CYAN"Descargando sources de $PRGNAM-$VERSION"$CIERRE"
	sleep 1
	aria2c -x 3 $DOWNLOAD
	fi
}

# Descomprimimos el fichero descargado y compilamos
F_compilar(){
echo 
echo "$VERDE"Descomprimiendo ..."$CIERRE"
sleep 1
deb2dir $TMP/subterfuge_1.0-1_all.deb $PKG

# Creamos el icono
echo "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
BMkJgwAAAABJRU5ErkJggg==" | base64 -d > $PKG/usr/share/pixmaps/$PRGNAM.png

# Creamos script lanzador
echo "#!/bin/sh

FIREFOX="'"firefox"'"
CHROME="'"/opt/google/chrome/google-chrome --user-data-dir="'"

killall subterfuge &>/dev/null
subterfuge &
sleep 5
if hash firefox &>/dev/null ; then
NAVEGADOR="'$FIREFOX'"
else
NAVEGADOR="'$CHROME'"
fi

"'$NAVEGADOR'" http://127.0.0.1:80/" > $PKG/bin/subterfuge-gui

# El script sera ejecutable
chmod 777 $PKG/bin/subterfuge-gui

# Creamos entrada desktop
echo "[Desktop Entry]
Categories=testing;
Exec=subterfuge-gui
Icon=subterfuge
MimeType=
Name=Subterfuge
Path=
StartupNotify=true
Terminal=true
TerminalOptions=
Type=Application" > $PKG/usr/share/applications/wifislax/Testing/$PRGNAM.desktop
}

###################################
## BLOQUE PRINCIPAL DE EJECUCION ##
###################################
# Si se cierra el script inesperadamente, ejecutar la funcion de limpieza
trap f_exitmode SIGHUP SIGINT

#Inicializamos las variables globales
f_variables
#Comprobamos conexion a Internet
f_comprobarConexion
#Inicializamos las variables del script
F_variables
#Creamos directorio de trabajo
f_directorioTemporal
#Creamos directorios extra
F_extradirs
#Mostramos el mensaje de presentacion
f_presentacion
#Comprobamos updates del script
f_comprobarUpdates
#Asignamos o detectamos arquitectura
f_arquitectura noarch
#Comprobamos version instalada del paquete
f_versionInstalada
#Compronar dependencias
F_dependencias
#Si no existe el fichero se descargara
F_download
#Descomprimir fichero descargado y compilamos
F_compilar
#Creamos xzm , instalamos y salimos
f_tareasFinales